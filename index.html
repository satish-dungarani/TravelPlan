<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>TravelPlan - Itinerary Manager</title>
    
    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#667eea">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="TravelPlan">
    <link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect fill='%23667eea' width='100' height='100' rx='20'/><text x='50' y='68' text-anchor='middle' fill='white' font-size='45'>‚úà</text></svg>">
    
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    
    <!-- HD Quality Icon Font -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
    
    <!-- PDF.js Library for PDF Viewing -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <script>
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
    </script>
    
    <!-- Flatpickr Date Picker -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/themes/airbnb.css">
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    
    <style>
        /* HD Quality Font Import */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');
        
        * {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            text-rendering: optimizeLegibility;
        }

        :root {
            --primary: #667eea;
            --primary-dark: #5a67d8;
            --secondary: #764ba2;
            --accent: #f093fb;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --info: #3b82f6;
            --bg-light: #f7f8fc;
            --bg-card: #ffffff;
            --text-primary: #1e293b;
            --text-secondary: #64748b;
            --text-muted: #94a3b8;
            --border-color: #e2e8f0;
            --sidebar-width: 240px;
            --header-height: 56px;
            --bottom-nav-height: 60px;
        }

        .dark {
            --bg-light: #0f172a;
            --bg-card: #1e293b;
            --text-primary: #f1f5f9;
            --text-secondary: #cbd5e1;
            --text-muted: #64748b;
            --border-color: #334155;
        }

        html {
            font-size: 16px;
            letter-spacing: -0.01em;
        }

        body {
            background: var(--bg-light);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
            line-height: 1.6;
        }

        /* HD Icon Styling */
        .fa-solid, .fa-regular, .fa-brands, .fas, .far, .fab, i[class*="fa-"] {
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            text-rendering: optimizeLegibility;
            font-style: normal;
        }

        /* Sidebar */
        .sidebar {
            width: var(--sidebar-width);
            height: 100vh;
            position: fixed;
            left: 0;
            top: 0;
            background: linear-gradient(180deg, #667eea 0%, #764ba2 100%);
            z-index: 100;
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            overflow-y: auto;
            box-shadow: 4px 0 24px rgba(102, 126, 234, 0.15);
        }

        .sidebar-header {
            padding: 16px 18px;
            border-bottom: 1px solid rgba(255,255,255,0.12);
        }

        .sidebar-logo {
            width: 36px;
            height: 36px;
            background: rgba(255,255,255,0.2);
            backdrop-filter: blur(10px);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .nav-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 18px;
            color: rgba(255,255,255,0.7);
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 13px;
            font-weight: 500;
            border-left: 3px solid transparent;
            margin: 1px 0;
            letter-spacing: 0.01em;
        }

        .nav-item:hover {
            background: rgba(255,255,255,0.08);
            color: #fff;
        }

        .nav-item.active {
            background: rgba(255,255,255,0.15);
            color: #fff;
            border-left-color: #fff;
            font-weight: 600;
        }

        .nav-item i {
            width: 18px;
            text-align: center;
            font-size: 14px;
            opacity: 0.9;
        }

        .nav-section {
            padding: 16px 18px 6px;
            font-size: 10px;
            font-weight: 700;
            color: rgba(255,255,255,0.4);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        /* Main Content */
        .main-content {
            margin-left: var(--sidebar-width);
            min-height: 100vh;
            transition: margin-left 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* Mobile Header */
        .mobile-header {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: var(--header-height);
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            z-index: 90;
            padding: 0 16px;
            align-items: center;
            justify-content: space-between;
            box-shadow: 0 2px 12px rgba(102, 126, 234, 0.2);
        }

        /* Bottom Navigation */
        .bottom-nav {
            display: none;
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            height: var(--bottom-nav-height);
            background: var(--bg-card);
            border-top: 1px solid var(--border-color);
            z-index: 90;
            box-shadow: 0 -2px 12px rgba(0,0,0,0.06);
            padding-bottom: env(safe-area-inset-bottom);
        }

        .bottom-nav-inner {
            display: flex;
            justify-content: space-around;
            align-items: center;
            height: 100%;
            max-width: 420px;
            margin: 0 auto;
        }

        .bottom-nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 3px;
            padding: 6px 12px;
            color: var(--text-muted);
            font-size: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            border-radius: 8px;
        }

        .bottom-nav-item i {
            font-size: 18px;
            transition: transform 0.2s ease;
        }

        .bottom-nav-item.active {
            color: var(--primary);
        }

        .bottom-nav-item.active i {
            transform: scale(1.05);
        }

        /* Responsive */
        @media (max-width: 1024px) {
            .sidebar {
                transform: translateX(-100%);
            }
            .sidebar.open {
                transform: translateX(0);
            }
            .sidebar-overlay {
                display: none;
                position: fixed;
                inset: 0;
                background: rgba(0,0,0,0.5);
                backdrop-filter: blur(4px);
                z-index: 95;
            }
            .sidebar-overlay.active {
                display: block;
            }
            .main-content {
                margin-left: 0;
                padding-top: var(--header-height);
                padding-bottom: var(--bottom-nav-height);
            }
            .mobile-header {
                display: flex;
            }
            .bottom-nav {
                display: block;
            }
        }

        /* Cards */
        .card {
            background: var(--bg-card);
            border-radius: 16px;
            box-shadow: 0 2px 12px rgba(0,0,0,0.04), 0 1px 3px rgba(0,0,0,0.06);
            border: 1px solid var(--border-color);
            transition: all 0.3s ease;
        }

        .card:hover {
            box-shadow: 0 8px 30px rgba(0,0,0,0.08), 0 2px 8px rgba(0,0,0,0.06);
            transform: translateY(-2px);
        }

        /* Stat Cards */
        .stat-card {
            padding: 16px;
            border-radius: 14px;
            color: white;
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle, rgba(255,255,255,0.15) 0%, transparent 70%);
            border-radius: 50%;
        }

        .stat-card.purple { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .stat-card.blue { background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); }
        .stat-card.orange { background: linear-gradient(135deg, #fa709a 0%, #fee140 100%); }
        .stat-card.green { background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%); }

        .stat-icon {
            width: 40px;
            height: 40px;
            background: rgba(255,255,255,0.2);
            backdrop-filter: blur(10px);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            margin-bottom: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .stat-value {
            font-size: 28px;
            font-weight: 700;
            letter-spacing: -0.02em;
            line-height: 1;
        }

        .stat-label {
            font-size: 12px;
            opacity: 0.9;
            margin-top: 4px;
            font-weight: 500;
        }

        /* Timeline */
        .timeline-container {
            position: relative;
            padding-left: 36px;
        }

        .timeline-container::before {
            content: '';
            position: absolute;
            left: 14px;
            top: 0;
            bottom: 0;
            width: 3px;
            background: linear-gradient(180deg, var(--primary) 0%, var(--secondary) 100%);
            border-radius: 2px;
        }

        .timeline-item {
            position: relative;
            margin-bottom: 24px;
        }

        .timeline-dot {
            position: absolute;
            left: -30px;
            top: 28px;
            width: 16px;
            height: 16px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            border-radius: 50%;
            border: 4px solid var(--bg-light);
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.4);
        }

        /* Transport Badge */
        .transport-badge {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 8px 14px;
            border-radius: 10px;
            font-size: 13px;
            font-weight: 600;
            letter-spacing: 0.02em;
        }

        .transport-badge i {
            font-size: 14px;
        }

        .transport-flight { background: linear-gradient(135deg, #667eea15 0%, #764ba215 100%); color: #667eea; border: 1px solid #667eea30; }
        .transport-train { background: linear-gradient(135deg, #10b98115 0%, #059b6915 100%); color: #059669; border: 1px solid #10b98130; }
        .transport-bus { background: linear-gradient(135deg, #f59e0b15 0%, #d9740015 100%); color: #d97400; border: 1px solid #f59e0b30; }
        .transport-boat { background: linear-gradient(135deg, #06b6d415 0%, #0891b215 100%); color: #0891b2; border: 1px solid #06b6d430; }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(15, 23, 42, 0.6);
            backdrop-filter: blur(8px);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 24px;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: var(--bg-card);
            border-radius: 24px;
            max-width: 580px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 25px 80px rgba(0,0,0,0.25);
            animation: modalSlide 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border: 1px solid var(--border-color);
        }

        @keyframes modalSlide {
            from { opacity: 0; transform: translateY(-30px) scale(0.95); }
            to { opacity: 1; transform: translateY(0) scale(1); }
        }

        /* Buttons */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            padding: 12px 24px;
            border-radius: 12px;
            font-weight: 600;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s ease;
            border: none;
            letter-spacing: 0.02em;
        }

        .btn i {
            font-size: 15px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.35);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.45);
        }

        .btn-secondary {
            background: var(--bg-light);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
        }

        .btn-secondary:hover {
            background: var(--border-color);
        }

        .btn-danger {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(239, 68, 68, 0.35);
        }

        .btn-success {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(16, 185, 129, 0.35);
        }

        /* Form Inputs */
        .form-input {
            width: 100%;
            padding: 14px 18px;
            border: 2px solid var(--border-color);
            border-radius: 12px;
            font-size: 15px;
            font-weight: 500;
            transition: all 0.2s ease;
            background: var(--bg-card);
            color: var(--text-primary);
        }

        .form-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.15);
        }

        .form-input::placeholder {
            color: var(--text-muted);
            font-weight: 400;
        }

        /* Sync Status */
        .sync-badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: 600;
            letter-spacing: 0.02em;
        }

        .sync-connected { background: rgba(16, 185, 129, 0.15); color: #10b981; }
        .sync-disconnected { background: rgba(239, 68, 68, 0.15); color: #ef4444; }
        .sync-syncing { background: rgba(245, 158, 11, 0.15); color: #f59e0b; }

        .pulse-dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: currentColor;
            animation: pulse 2s infinite;
            box-shadow: 0 0 6px currentColor;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.5; transform: scale(0.9); }
        }

        /* Auth Screen */
        .auth-screen {
            position: fixed;
            inset: 0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            z-index: 3000;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .auth-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 40px;
            border-radius: 24px;
            width: 100%;
            max-width: 400px;
            text-align: center;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            animation: slideUp 0.5s cubic-bezier(0.16, 1, 0.3, 1);
        }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .shake {
            animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both;
        }

        @keyframes shake {
            10%, 90% { transform: translate3d(-1px, 0, 0); }
            20%, 80% { transform: translate3d(2px, 0, 0); }
            30%, 50%, 70% { transform: translate3d(-4px, 0, 0); }
            40%, 60% { transform: translate3d(4px, 0, 0); }
        }

        /* Loading */
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        .animate-spin {
            animation: spin 1s linear infinite;
        }

        /* Scrollbar */
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: var(--border-color); border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: var(--text-muted); }

        /* Print */
        @media print {
            .sidebar, .mobile-header, .bottom-nav, .no-print { display: none !important; }
            .main-content { margin: 0 !important; padding: 0 !important; }
            .card { break-inside: avoid; box-shadow: none !important; border: 1px solid #ddd !important; }
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 60px 24px;
            color: var(--text-secondary);
        }

        .empty-icon {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, #667eea15 0%, #764ba215 100%);
            border-radius: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 20px;
            font-size: 32px;
            color: var(--primary);
        }

        /* Activity Item */
        .activity-item {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            padding: 10px 0;
            font-size: 15px;
            color: var(--text-primary);
            line-height: 1.5;
        }

        .activity-item i {
            color: var(--success);
            margin-top: 5px;
            font-size: 10px;
        }

        /* FAB */
        .fab {
            position: fixed;
            bottom: calc(var(--bottom-nav-height) + 16px);
            right: 16px;
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 14px;
            display: none;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 20px;
            box-shadow: 0 4px 20px rgba(102, 126, 234, 0.4);
            cursor: pointer;
            z-index: 80;
            transition: all 0.3s ease;
        }

        .fab:hover {
            transform: scale(1.05);
        }

        @media (max-width: 1024px) {
            .fab { display: flex; }
        }

        /* Table */
        .data-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 14px;
        }

        .data-table th {
            text-align: left;
            padding: 16px 20px;
            font-size: 12px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.8px;
            color: var(--text-muted);
            background: var(--bg-light);
            border-bottom: 2px solid var(--border-color);
        }

        .data-table td {
            padding: 18px 20px;
            border-bottom: 1px solid var(--border-color);
            font-weight: 500;
        }

        .data-table tr:hover {
            background: var(--bg-light);
        }

        /* Section Title */
        .section-title {
            font-size: 12px;
            font-weight: 700;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 16px;
        }

        /* Info Badge */
        .info-badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            border-radius: 8px;
            font-size: 12px;
            font-weight: 600;
            background: var(--bg-light);
            color: var(--text-secondary);
        }

        /* Action Button */
        .action-btn {
            width: 40px;
            height: 40px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-muted);
            background: transparent;
            border: none;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 16px;
        }

        .action-btn:hover {
            background: var(--bg-light);
            color: var(--primary);
        }

        .action-btn.danger:hover {
            background: rgba(239, 68, 68, 0.1);
            color: #ef4444;
        }

        /* Hotel Card */
        .hotel-card {
            position: relative;
            overflow: hidden;
        }

        .hotel-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
        }

        /* Transport Card */
        .transport-card {
            border-left: 4px solid;
        }

        .transport-card.flight { border-left-color: #667eea; }
        .transport-card.train { border-left-color: #10b981; }
        .transport-card.bus { border-left-color: #f59e0b; }
        .transport-card.boat { border-left-color: #06b6d4; }

        /* Day Card Header */
        .day-header {
            background: linear-gradient(135deg, #667eea08 0%, #764ba208 100%);
            border-bottom: 1px solid var(--border-color);
            padding: 20px 24px;
            border-radius: 16px 16px 0 0;
        }

        /* Quick Action Card */
        .quick-action {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 14px;
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s ease;
            font-weight: 500;
            font-size: 13px;
        }

        .quick-action:hover {
            border-color: var(--primary);
            background: linear-gradient(135deg, #667eea08 0%, #764ba208 100%);
            transform: translateX(2px);
        }

        .quick-action i {
            width: 34px;
            height: 34px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 14px;
        }

        /* Load Trip Banner */
        .trip-banner {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 20px;
            padding: 28px;
            color: white;
            position: relative;
            overflow: hidden;
        }

        .trip-banner::before {
            content: 'üá®üá≠üáÆüáπ';
            position: absolute;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 48px;
            opacity: 0.3;
        }

        /* Upcoming Day Item */
        .upcoming-item {
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 16px;
            border-radius: 14px;
            transition: all 0.2s ease;
            cursor: pointer;
        }

        .upcoming-item:hover {
            background: var(--bg-light);
        }

        .upcoming-date {
            width: 56px;
            height: 48px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 700;
            flex-shrink: 0;
        }

        .upcoming-date .month {
            font-size: 13px;
            font-weight: 700;
            letter-spacing: 0.5px;
            line-height: 1.2;
        }

        .upcoming-date .day {
            font-size: 10px;
            line-height: 1;
            opacity: 0.8;
        }

        /* File Upload Zone */
        .file-upload-zone {
            border: 2px dashed var(--border-color);
            border-radius: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: var(--bg-light);
        }

        .file-upload-zone:hover {
            border-color: var(--primary);
            background: linear-gradient(135deg, #667eea08 0%, #764ba208 100%);
        }

        .file-upload-zone.dragover {
            border-color: var(--primary);
            background: linear-gradient(135deg, #667eea15 0%, #764ba215 100%);
            transform: scale(1.02);
        }

        /* File Gallery */
        .file-gallery {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            gap: 12px;
        }

        .file-gallery-item {
            position: relative;
            aspect-ratio: 1;
            border-radius: 12px;
            overflow: hidden;
            border: 2px solid var(--border-color);
            background: var(--bg-light);
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .file-gallery-item:hover {
            border-color: var(--primary);
            transform: scale(1.05);
            box-shadow: 0 8px 20px rgba(0,0,0,0.15);
        }

        .file-gallery-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .file-gallery-item .pdf-icon {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #ef444415 0%, #dc262615 100%);
            color: #ef4444;
        }

        .file-gallery-item .pdf-icon i {
            font-size: 32px;
            margin-bottom: 8px;
        }

        .file-gallery-item .pdf-icon span {
            font-size: 10px;
            font-weight: 600;
            text-align: center;
            padding: 0 8px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            max-width: 100%;
        }

        .file-gallery-item .remove-btn {
            position: absolute;
            top: 4px;
            right: 4px;
            width: 24px;
            height: 24px;
            background: rgba(239, 68, 68, 0.9);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 12px;
            opacity: 0;
            transition: opacity 0.2s ease;
            border: none;
            cursor: pointer;
        }

        .file-gallery-item:hover .remove-btn {
            opacity: 1;
        }

        .file-gallery-item .file-type-badge {
            position: absolute;
            bottom: 4px;
            left: 4px;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 9px;
            font-weight: 700;
            text-transform: uppercase;
            background: rgba(0,0,0,0.6);
            color: white;
        }

        /* Existing Files Section */
        .existing-files-section {
            margin-top: 16px;
            padding-top: 16px;
            border-top: 1px solid var(--border-color);
        }

        .existing-files-title {
            font-size: 12px;
            font-weight: 700;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .existing-files-title i {
            color: var(--success);
        }

        /* File Viewer Modal - Professional Design */
        .file-viewer-modal {
            max-width: 95vw;
            width: 900px;
            max-height: 95vh;
            display: flex;
            flex-direction: column;
            padding: 0;
            overflow: hidden;
        }

        .file-viewer-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 16px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            gap: 12px;
            flex-wrap: wrap;
        }

        .file-viewer-title-section {
            display: flex;
            align-items: center;
            gap: 10px;
            min-width: 0;
            flex: 1;
        }

        .file-viewer-icon {
            width: 36px;
            height: 36px;
            background: rgba(255,255,255,0.2);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            flex-shrink: 0;
        }

        .file-viewer-title {
            font-size: 14px;
            font-weight: 600;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 200px;
        }

        .file-viewer-page-info {
            font-size: 11px;
            opacity: 0.8;
            margin-top: 2px;
        }

        .file-viewer-actions {
            display: flex;
            align-items: center;
            gap: 8px;
            flex-wrap: wrap;
        }

        .file-viewer-nav {
            display: flex;
            align-items: center;
            gap: 4px;
            background: rgba(255,255,255,0.15);
            padding: 4px;
            border-radius: 8px;
        }

        .file-nav-btn {
            width: 28px;
            height: 28px;
            border: none;
            background: transparent;
            color: white;
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            transition: all 0.2s ease;
        }

        .file-nav-btn:hover {
            background: rgba(255,255,255,0.25);
        }

        .file-nav-divider {
            width: 1px;
            height: 20px;
            background: rgba(255,255,255,0.3);
            margin: 0 4px;
        }

        .file-action-buttons {
            display: flex;
            gap: 4px;
        }

        .file-action-btn {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            border: none;
            background: rgba(255,255,255,0.2);
            color: white;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 500;
            transition: all 0.2s ease;
        }

        .file-action-btn:hover {
            background: rgba(255,255,255,0.35);
        }

        .file-action-btn i {
            font-size: 12px;
        }

        .file-close-btn {
            width: 32px;
            height: 32px;
            border: none;
            background: rgba(255,255,255,0.2);
            color: white;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            transition: all 0.2s ease;
            margin-left: 4px;
        }

        .file-close-btn:hover {
            background: rgba(239, 68, 68, 0.8);
        }

        .file-viewer-content {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #1a1a2e;
            overflow: auto;
            min-height: 400px;
            max-height: calc(95vh - 70px);
            padding: 16px;
        }

        .pdf-canvas {
            max-width: 100%;
            height: auto;
            box-shadow: 0 4px 24px rgba(0,0,0,0.4);
            border-radius: 4px;
        }

        .image-viewer {
            max-width: 100%;
            max-height: calc(95vh - 100px);
            object-fit: contain;
            border-radius: 8px;
            box-shadow: 0 4px 24px rgba(0,0,0,0.4);
        }

        .file-loading {
            text-align: center;
            color: rgba(255,255,255,0.7);
        }

        .file-loading-spinner {
            width: 40px;
            height: 40px;
            border: 3px solid rgba(255,255,255,0.1);
            border-top-color: #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 12px;
        }

        .file-loading p {
            font-size: 13px;
        }

        .file-error {
            text-align: center;
            color: #ef4444;
        }

        .file-error i {
            font-size: 36px;
            margin-bottom: 12px;
            opacity: 0.7;
        }

        .file-error p {
            font-size: 13px;
        }

        /* Mobile Responsive */
        @media (max-width: 640px) {
            .file-viewer-modal {
                width: 100%;
                max-width: 100%;
                max-height: 100vh;
                border-radius: 0;
                margin: 0;
            }

            .file-viewer-header {
                padding: 10px 12px;
            }

            .file-viewer-title {
                font-size: 13px;
                max-width: 120px;
            }

            .file-viewer-icon {
                width: 32px;
                height: 32px;
                font-size: 14px;
            }

            .file-action-label {
                display: none;
            }

            .file-action-btn {
                padding: 6px 8px;
            }

            .file-nav-btn {
                width: 26px;
                height: 26px;
            }

            .file-viewer-content {
                min-height: calc(100vh - 120px);
                max-height: calc(100vh - 60px);
                padding: 12px;
            }

            .pdf-canvas {
                max-width: 100%;
            }
        }

        /* Tablet */
        @media (min-width: 641px) and (max-width: 1024px) {
            .file-viewer-modal {
                width: 90vw;
                max-width: 800px;
            }
        }

        /* Print styles for file viewer */
        @media print {
            .file-viewer-header {
                display: none !important;
            }
            .file-viewer-content {
                background: white !important;
                max-height: none !important;
            }
            .pdf-canvas, .image-viewer {
                max-width: 100% !important;
                max-height: none !important;
                box-shadow: none !important;
            }
        }

        /* Professional Modal Enhancements */
        .modal-content {
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* Mobile Modal Full Screen */
        @media (max-width: 640px) {
            .modal {
                padding: 0;
                align-items: flex-end;
            }
            
            .modal-content {
                max-height: 95vh;
                width: 100%;
                max-width: 100%;
                border-radius: 24px 24px 0 0;
                animation: modalSlideUp 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            }
            
            .modal-content > div:first-child {
                border-radius: 24px 24px 0 0;
            }
            
            .modal-content > div:last-child {
                border-radius: 0;
            }
            
            @keyframes modalSlideUp {
                from { opacity: 0; transform: translateY(100%); }
                to { opacity: 1; transform: translateY(0); }
            }
        }

        /* Tablet Modal */
        @media (min-width: 641px) and (max-width: 1024px) {
            .modal-content {
                max-width: 90%;
            }
        }

        /* Form label styling consistency */
        .form-label {
            display: block;
            font-size: 11px;
            font-weight: 600;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 6px;
        }

        /* Flatpickr Custom Styling */
        .flatpickr-calendar {
            font-family: 'Inter', sans-serif !important;
            border-radius: 16px !important;
            box-shadow: 0 10px 40px rgba(0,0,0,0.15) !important;
            border: 1px solid var(--border-color) !important;
        }

        .flatpickr-months {
            border-radius: 16px 16px 0 0 !important;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;
            padding: 8px !important;
        }

        .flatpickr-months .flatpickr-month {
            color: white !important;
            fill: white !important;
        }

        .flatpickr-current-month .flatpickr-monthDropdown-months,
        .flatpickr-current-month input.cur-year {
            color: white !important;
            font-weight: 600 !important;
        }

        .flatpickr-months .flatpickr-prev-month,
        .flatpickr-months .flatpickr-next-month {
            fill: white !important;
            color: white !important;
        }

        .flatpickr-months .flatpickr-prev-month:hover,
        .flatpickr-months .flatpickr-next-month:hover {
            background: rgba(255,255,255,0.2) !important;
            border-radius: 8px !important;
        }

        .flatpickr-weekdays {
            background: transparent !important;
        }

        .flatpickr-weekday {
            color: var(--text-muted) !important;
            font-weight: 600 !important;
            font-size: 12px !important;
        }

        .flatpickr-day {
            border-radius: 8px !important;
            font-weight: 500 !important;
        }

        .flatpickr-day:hover {
            background: linear-gradient(135deg, #667eea15 0%, #764ba215 100%) !important;
            border-color: transparent !important;
        }

        .flatpickr-day.selected {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;
            border-color: transparent !important;
        }

        .flatpickr-day.today {
            border-color: var(--primary) !important;
        }

        .flatpickr-day.today:hover {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;
            color: white !important;
        }

        /* Dark mode support for flatpickr */
        .dark .flatpickr-calendar {
            background: var(--bg-card) !important;
        }

        .dark .flatpickr-day {
            color: var(--text-primary) !important;
        }

        .dark .flatpickr-day.prevMonthDay,
        .dark .flatpickr-day.nextMonthDay {
            color: var(--text-muted) !important;
        }
    </style>
</head>
<body>
    <!-- Sidebar Overlay -->
    <div id="sidebarOverlay" class="sidebar-overlay" onclick="toggleSidebar()"></div>

    <!-- Sidebar -->
    <aside id="sidebar" class="sidebar">
        <div class="sidebar-header">
            <div class="flex items-center gap-3">
                <div class="sidebar-logo">
                    <i class="fa-solid fa-paper-plane"></i>
                </div>
                <div>
                    <h1 class="text-white font-semibold text-base tracking-tight">TravelPlan</h1>
                    <p class="text-white/50 text-xs">Itinerary Manager</p>
                </div>
            </div>
        </div>

        <nav class="py-4">
            <div class="nav-section">Main Menu</div>
            
            <div class="nav-item active" data-tab="dashboard" onclick="switchTab('dashboard')">
                <i class="fa-solid fa-house"></i>
                <span>Dashboard</span>
            </div>
            <div class="nav-item" data-tab="itinerary" onclick="switchTab('itinerary')">
                <i class="fa-solid fa-calendar-days"></i>
                <span>Full Itinerary</span>
            </div>
            <div class="nav-item" data-tab="hotels" onclick="switchTab('hotels')">
                <i class="fa-solid fa-hotel"></i>
                <span>Hotels</span>
            </div>
            <div class="nav-item" data-tab="transport-guide" onclick="switchTab('transport-guide')">
                <i class="fa-solid fa-train"></i>
                <span>Transport Guide</span>
            </div>
            <div class="nav-item" data-tab="transport-list" onclick="switchTab('transport-list')">
                <i class="fa-solid fa-list-ul"></i>
                <span>Transport List</span>
            </div>
            <div class="nav-item" data-tab="builder" onclick="switchTab('builder')">
                <i class="fa-solid fa-wand-magic-sparkles"></i>
                <span>Day Builder</span>
            </div>

            <div class="nav-section">Settings</div>
            
            <div class="nav-item" onclick="openFirebaseSettings()">
                <i class="fa-solid fa-database"></i>
                <span>Database</span>
            </div>
            <div class="nav-item" onclick="toggleDarkMode()">
                <i class="fa-solid fa-moon"></i>
                <span>Dark Mode</span>
            </div>
            <div class="nav-item" onclick="exportData()">
                <i class="fa-solid fa-download"></i>
                <span>Export Data</span>
            </div>
            <div class="nav-item" onclick="logout()">
                <i class="fa-solid fa-right-from-bracket"></i>
                <span>Logout</span>
            </div>
        </nav>

        <!-- Sync Status -->
        <div class="absolute bottom-0 left-0 right-0 p-3 border-t border-white/10">
            <div id="sidebarSyncStatus" class="sync-badge sync-connected text-xs">
                <div class="pulse-dot"></div>
                <span>Connected</span>
            </div>
        </div>
    </aside>

    <!-- Mobile Header -->
    <header class="mobile-header">
        <button onclick="toggleSidebar()" class="text-white p-1.5 -ml-1">
            <i class="fa-solid fa-bars text-lg"></i>
        </button>
        <span class="text-white font-semibold text-sm">TravelPlan</span>
        <div id="mobileSyncStatus" class="sync-badge sync-connected">
            <div class="pulse-dot"></div>
        </div>
    </header>

    <!-- Bottom Navigation -->
    <nav class="bottom-nav">
        <div class="bottom-nav-inner">
            <div class="bottom-nav-item active" data-tab="dashboard" onclick="switchTab('dashboard')">
                <i class="fa-solid fa-house"></i>
                <span>Home</span>
            </div>
            <div class="bottom-nav-item" data-tab="itinerary" onclick="switchTab('itinerary')">
                <i class="fa-solid fa-calendar-days"></i>
                <span>Itinerary</span>
            </div>
            <div class="bottom-nav-item" data-tab="hotels" onclick="switchTab('hotels')">
                <i class="fa-solid fa-hotel"></i>
                <span>Hotels</span>
            </div>
            <div class="bottom-nav-item" data-tab="transport-guide" onclick="switchTab('transport-guide')">
                <i class="fa-solid fa-train"></i>
                <span>Transport</span>
            </div>
            <div class="bottom-nav-item" data-tab="builder" onclick="switchTab('builder')">
                <i class="fa-solid fa-wand-magic-sparkles"></i>
                <span>Builder</span>
            </div>
        </div>
    </nav>

    <!-- FAB -->
    <div id="fab" class="fab no-print" onclick="handleFabClick()">
        <i class="fa-solid fa-plus"></i>
    </div>

    <!-- Main Content -->
    <main class="main-content">
        <div class="p-4 md:p-6 max-w-7xl">
            <!-- Dashboard -->
            <div id="tab-dashboard" class="tab-content">
                <div class="mb-8">
                    <h1 class="text-3xl font-bold mb-2">Dashboard</h1>
                    <p class="text-[var(--text-secondary)] text-lg">Overview of your travel plans</p>
                </div>

                <!-- Load Trip Banner -->
                <div id="loadTripBanner" class="trip-banner mb-8">
                    <div class="relative z-10">
                        <h2 class="text-2xl font-bold mb-2">üèîÔ∏è Alpine Romance Trip</h2>
                        <p class="text-white/80 mb-4 max-w-md">Load the complete 10-day Switzerland & Italy itinerary with all hotels, transport, and daily plans.</p>
                        <button onclick="loadAlpineRomanceData()" class="bg-white text-[var(--primary)] px-6 py-3 rounded-xl font-bold hover:bg-white/90 transition-all inline-flex items-center gap-2">
                            <i class="fa-solid fa-download"></i> Load Trip Data
                        </button>
                    </div>
                </div>

                <!-- Stats -->
                <div class="grid grid-cols-2 lg:grid-cols-4 gap-5 mb-8">
                    <div class="stat-card purple">
                        <div class="stat-icon">
                            <i class="fa-solid fa-calendar-days"></i>
                        </div>
                        <div class="stat-value" id="statDays">0</div>
                        <div class="stat-label">Travel Days</div>
                    </div>
                    <div class="stat-card blue">
                        <div class="stat-icon">
                            <i class="fa-solid fa-hotel"></i>
                        </div>
                        <div class="stat-value" id="statHotels">0</div>
                        <div class="stat-label">Hotels</div>
                    </div>
                    <div class="stat-card orange">
                        <div class="stat-icon">
                            <i class="fa-solid fa-train"></i>
                        </div>
                        <div class="stat-value" id="statTransport">0</div>
                        <div class="stat-label">Transport</div>
                    </div>
                    <div class="stat-card green">
                        <div class="stat-icon">
                            <i class="fa-solid fa-location-dot"></i>
                        </div>
                        <div class="stat-value" id="statCities">0</div>
                        <div class="stat-label">Cities</div>
                    </div>
                </div>

                <!-- Content Grid -->
                <div class="grid lg:grid-cols-3 gap-6">
                    <!-- Upcoming -->
                    <div class="lg:col-span-2 card p-6">
                        <div class="flex items-center justify-between mb-5">
                            <h2 class="text-xl font-bold">Upcoming Days</h2>
                            <button onclick="switchTab('itinerary')" class="text-sm font-semibold text-[var(--primary)] hover:underline">
                                View All <i class="fa-solid fa-arrow-right ml-1"></i>
                            </button>
                        </div>
                        <div id="upcomingDays" class="space-y-2"></div>
                    </div>

                    <!-- Quick Actions -->
                    <div class="card p-6">
                        <h2 class="text-xl font-bold mb-5">Quick Actions</h2>
                        <div class="space-y-3">
                            <div class="quick-action" onclick="openDayModal()">
                                <i class="fa-solid fa-calendar-plus"></i>
                                <span>Add New Day</span>
                            </div>
                            <div class="quick-action" onclick="openHotelModal()">
                                <i class="fa-solid fa-hotel"></i>
                                <span>Add Hotel</span>
                            </div>
                            <div class="quick-action" onclick="openTransportModal()">
                                <i class="fa-solid fa-train"></i>
                                <span>Add Transport</span>
                            </div>
                            <div class="quick-action" onclick="printItinerary()">
                                <i class="fa-solid fa-print"></i>
                                <span>Print Itinerary</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Transport Schedule -->
                <div class="card p-6 mt-6">
                    <div class="flex items-center justify-between mb-5">
                        <h2 class="text-xl font-bold">Transport Schedule</h2>
                        <button onclick="switchTab('transport-guide')" class="text-sm font-semibold text-[var(--primary)] hover:underline">
                            View All <i class="fa-solid fa-arrow-right ml-1"></i>
                        </button>
                    </div>
                    <div id="recentTransport" class="space-y-3"></div>
                </div>
            </div>

            <!-- Itinerary -->
            <div id="tab-itinerary" class="tab-content hidden">
                <div class="flex flex-col md:flex-row md:items-center justify-between gap-4 mb-8">
                    <div>
                        <h1 class="text-3xl font-bold mb-2">Full Itinerary</h1>
                        <p class="text-[var(--text-secondary)] text-lg">Day-by-day travel plan</p>
                    </div>
                    <div class="flex gap-3">
                        <div class="relative flex-1 md:w-64">
                            <i class="fa-solid fa-search absolute left-4 top-1/2 -translate-y-1/2 text-[var(--text-muted)]"></i>
                            <input type="text" id="searchInput" placeholder="Search days..." class="form-input pl-12" oninput="filterItems()">
                        </div>
                        <button onclick="openDayModal()" class="btn btn-primary">
                            <i class="fa-solid fa-plus"></i>
                            <span class="hidden md:inline">Add Day</span>
                        </button>
                    </div>
                </div>
                <div id="itineraryContainer" class="timeline-container"></div>
            </div>

            <!-- Hotels -->
            <div id="tab-hotels" class="tab-content hidden">
                <div class="flex flex-col md:flex-row md:items-center justify-between gap-4 mb-8">
                    <div>
                        <h1 class="text-3xl font-bold mb-2">Hotels</h1>
                        <p class="text-[var(--text-secondary)] text-lg">Your accommodations</p>
                    </div>
                    <button onclick="openHotelModal()" class="btn btn-primary">
                        <i class="fa-solid fa-plus"></i> Add Hotel
                    </button>
                </div>
                <div id="hotelsContainer" class="grid gap-6 md:grid-cols-2 xl:grid-cols-3"></div>
            </div>

            <!-- Transport Guide -->
            <div id="tab-transport-guide" class="tab-content hidden">
                <div class="flex flex-col md:flex-row md:items-center justify-between gap-4 mb-8">
                    <div>
                        <h1 class="text-3xl font-bold mb-2">Transport Guide</h1>
                        <p class="text-[var(--text-secondary)] text-lg">Detailed transport information</p>
                    </div>
                    <button onclick="openTransportModal()" class="btn btn-primary">
                        <i class="fa-solid fa-plus"></i> Add Transport
                    </button>
                </div>
                <div id="transportGuideContainer" class="space-y-4"></div>
            </div>

            <!-- Transport List -->
            <div id="tab-transport-list" class="tab-content hidden">
                <div class="mb-8">
                    <h1 class="text-3xl font-bold mb-2">Transport List</h1>
                    <p class="text-[var(--text-secondary)] text-lg">Quick reference schedule</p>
                </div>
                <div class="card overflow-hidden">
                    <div class="overflow-x-auto">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Date</th>
                                    <th>Route</th>
                                    <th>Type</th>
                                    <th>Time</th>
                                    <th>Notes</th>
                                </tr>
                            </thead>
                            <tbody id="transportListTable"></tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Day Builder -->
            <div id="tab-builder" class="tab-content hidden">
                <div class="mb-8">
                    <h1 class="text-3xl font-bold mb-2">Day Builder</h1>
                    <p class="text-[var(--text-secondary)] text-lg">Create your perfect travel day</p>
                </div>
                <div class="grid lg:grid-cols-2 gap-6">
                    <div class="card p-6">
                        <h3 class="text-lg font-bold mb-5">
                            <i class="fa-solid fa-wand-magic-sparkles text-[var(--primary)] mr-2"></i>
                            Build Your Day
                        </h3>
                        <form id="dayBuilderForm" class="space-y-5">
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-semibold mb-2">Date</label>
                                    <input type="text" id="builderDate" required class="form-input" placeholder="DD/MM/YYYY" maxlength="10">
                                </div>
                                <div>
                                    <label class="block text-sm font-semibold mb-2">City</label>
                                    <input type="text" id="builderCity" required placeholder="e.g., Paris" class="form-input">
                                </div>
                            </div>

                            <div>
                                <label class="block text-sm font-semibold mb-2">Hotel</label>
                                <select id="builderHotel" class="form-input">
                                    <option value="">Select hotel...</option>
                                </select>
                            </div>

                            <div>
                                <label class="block text-sm font-semibold mb-2">Transport</label>
                                <select id="builderTransport" multiple class="form-input h-28"></select>
                                <p class="text-xs text-[var(--text-muted)] mt-2">Hold Ctrl/Cmd to select multiple</p>
                            </div>

                            <div>
                                <label class="block text-sm font-semibold mb-2">Activities</label>
                                <div id="activitiesContainer" class="space-y-2 mb-3"></div>
                                <button type="button" onclick="addActivityInput()" class="text-sm font-semibold text-[var(--primary)] hover:underline">
                                    <i class="fa-solid fa-plus mr-1"></i> Add Activity
                                </button>
                            </div>

                            <div>
                                <label class="block text-sm font-semibold mb-2">Notes</label>
                                <textarea id="builderNotes" rows="3" placeholder="Additional notes..." class="form-input"></textarea>
                            </div>

                            <div>
                                <label class="block text-sm font-semibold mb-2">Images</label>
                                <input type="file" id="builderImages" accept="image/*" multiple class="form-input">
                                <div id="imagePreviewContainer" class="flex flex-wrap gap-2 mt-3"></div>
                            </div>

                            <div>
                                <label class="block text-sm font-semibold mb-2">Documents</label>
                                <input type="file" id="builderDocs" accept=".pdf" multiple class="form-input">
                                <div id="docPreviewContainer" class="flex flex-wrap gap-2 mt-3"></div>
                            </div>

                            <div class="flex gap-3 pt-3">
                                <button type="submit" class="flex-1 btn btn-primary">
                                    <i class="fa-solid fa-save"></i> Save Day
                                </button>
                                <button type="button" onclick="resetBuilder()" class="btn btn-secondary">
                                    <i class="fa-solid fa-rotate-left"></i>
                                </button>
                            </div>
                        </form>
                    </div>

                    <div class="card p-6">
                        <h3 class="text-lg font-bold mb-5">
                            <i class="fa-solid fa-eye text-[var(--primary)] mr-2"></i>
                            Preview
                        </h3>
                        <div id="dayPreview" class="text-[var(--text-secondary)]">
                            <div class="empty-state py-10">
                                <div class="empty-icon">
                                    <i class="fa-solid fa-eye"></i>
                                </div>
                                <p>Fill the form to see preview</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Auth Screen -->
    <div id="authScreen" class="auth-screen">
        <div class="auth-card">
            <div class="w-20 h-20 bg-gradient-to-br from-[var(--primary)] to-[var(--secondary)] rounded-full flex items-center justify-center mx-auto mb-6 shadow-lg text-white text-3xl">
                <i class="fa-solid fa-lock"></i>
            </div>
            <h2 class="text-2xl font-bold text-gray-800 mb-2">Login Required</h2>
            <p class="text-gray-500 mb-8">Please enter the default password to access</p>
            
            <form id="authForm" class="space-y-4">
                <input type="password" id="authPassword" class="form-input text-center text-lg tracking-widest" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required>
                <button type="submit" class="w-full btn btn-primary py-4 text-lg shadow-lg">
                    <i class="fa-solid fa-arrow-right"></i> Login
                </button>
            </form>
            <p class="mt-6 text-sm text-gray-400">
                Default Password: <strong>1234</strong>
            </p>
        </div>
    </div>

    <!-- Firebase Config Modal -->
    <div id="firebaseConfigModal" class="modal">
        <div class="modal-content max-w-md">
            <!-- Professional Header -->
            <div class="flex items-center justify-between p-4 bg-gradient-to-r from-[var(--primary)] to-[var(--secondary)] text-white rounded-t-3xl">
                <div class="flex items-center gap-3">
                    <div class="w-10 h-10 bg-white/20 rounded-xl flex items-center justify-center">
                        <i class="fa-solid fa-plug"></i>
                    </div>
                    <div>
                        <h3 class="text-lg font-bold">Firebase Setup</h3>
                        <p class="text-xs text-white/70">Connect to database</p>
                    </div>
                </div>
            </div>
            <!-- Content -->
            <div class="p-5">
                <div class="flex mb-5 bg-[var(--bg-light)] rounded-xl p-1">
                    <button type="button" onclick="switchConfigTab('json')" id="jsonTabBtn" class="flex-1 py-2.5 px-4 rounded-lg text-sm font-bold bg-[var(--bg-card)] shadow-sm">
                        <i class="fa-solid fa-code mr-1"></i> Paste JSON
                    </button>
                    <button type="button" onclick="switchConfigTab('manual')" id="manualTabBtn" class="flex-1 py-2.5 px-4 rounded-lg text-sm font-bold text-[var(--text-muted)]">
                        <i class="fa-solid fa-keyboard mr-1"></i> Manual
                    </button>
                </div>

                <div id="jsonConfigTab">
                    <label class="block text-xs font-semibold text-[var(--text-muted)] uppercase tracking-wide mb-1.5">Firebase Config JSON</label>
                    <textarea id="configJsonInput" rows="6" placeholder='Paste your Firebase config JSON here...' class="form-input font-mono text-xs mb-4"></textarea>
                    <button type="button" onclick="connectWithJson()" class="w-full btn btn-primary py-3">
                        <i class="fa-solid fa-plug"></i> Connect to Firebase
                    </button>
                </div>

                <form id="firebaseConfigForm" class="space-y-3 hidden">
                    <div>
                        <label class="block text-xs font-semibold text-[var(--text-muted)] uppercase tracking-wide mb-1.5">API Key</label>
                        <input type="text" id="configApiKey" required placeholder="AIza..." class="form-input">
                    </div>
                    <div>
                        <label class="block text-xs font-semibold text-[var(--text-muted)] uppercase tracking-wide mb-1.5">Auth Domain</label>
                        <input type="text" id="configAuthDomain" required placeholder="your-app.firebaseapp.com" class="form-input">
                    </div>
                    <div>
                        <label class="block text-xs font-semibold text-[var(--text-muted)] uppercase tracking-wide mb-1.5">Database URL</label>
                        <input type="text" id="configDatabaseURL" required placeholder="https://your-app.firebaseio.com" class="form-input">
                    </div>
                    <div>
                        <label class="block text-xs font-semibold text-[var(--text-muted)] uppercase tracking-wide mb-1.5">Project ID</label>
                        <input type="text" id="configProjectId" required placeholder="your-project-id" class="form-input">
                    </div>
                    <div>
                        <label class="block text-xs font-semibold text-[var(--text-muted)] uppercase tracking-wide mb-1.5">Storage Bucket (optional)</label>
                        <input type="text" id="configStorageBucket" placeholder="your-app.appspot.com" class="form-input">
                    </div>
                    <button type="submit" class="w-full btn btn-primary py-3 mt-2">
                        <i class="fa-solid fa-plug"></i> Connect to Firebase
                    </button>
                </form>

                <div id="configError" class="hidden mt-4 p-3 bg-red-50 dark:bg-red-900/20 rounded-xl text-red-600 dark:text-red-400 text-sm font-medium"></div>
            </div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="hidden fixed inset-0 bg-[var(--bg-light)]/90 backdrop-blur-sm z-[2000] flex items-center justify-center">
        <div class="text-center">
            <div class="w-16 h-16 border-4 border-[var(--border-color)] border-t-[var(--primary)] rounded-full animate-spin mx-auto mb-5"></div>
            <p class="text-lg font-semibold text-[var(--text-secondary)]" id="loadingText">Connecting...</p>
        </div>
    </div>

    <!-- Day Modal -->
    <div id="dayModal" class="modal">
        <div class="modal-content">
            <!-- Professional Header -->
            <div class="flex items-center justify-between p-4 bg-gradient-to-r from-[var(--primary)] to-[var(--secondary)] text-white rounded-t-3xl">
                <div class="flex items-center gap-3">
                    <div class="w-10 h-10 bg-white/20 rounded-xl flex items-center justify-center">
                        <i class="fa-solid fa-calendar-plus"></i>
                    </div>
                    <div>
                        <h3 class="text-lg font-bold" id="dayModalTitle">Add Day</h3>
                        <p class="text-xs text-white/70">Plan your travel day</p>
                    </div>
                </div>
                <button onclick="closeDayModal()" class="w-8 h-8 rounded-lg bg-white/20 hover:bg-red-500/80 flex items-center justify-center transition-colors">
                    <i class="fa-solid fa-xmark"></i>
                </button>
            </div>
            <!-- Form Content -->
            <div class="p-5 max-h-[70vh] overflow-y-auto">
                <form id="dayForm" class="space-y-4">
                    <input type="hidden" id="dayId">
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-xs font-semibold text-[var(--text-muted)] uppercase tracking-wide mb-1.5">Date</label>
                            <input type="text" id="dayDate" required class="form-input" placeholder="DD/MM/YYYY" maxlength="10">
                        </div>
                        <div>
                            <label class="block text-xs font-semibold text-[var(--text-muted)] uppercase tracking-wide mb-1.5">City</label>
                            <input type="text" id="dayCity" required class="form-input" placeholder="e.g., Paris">
                        </div>
                    </div>
                    <div>
                        <label class="block text-xs font-semibold text-[var(--text-muted)] uppercase tracking-wide mb-1.5">Hotel</label>
                        <select id="dayHotel" class="form-input"></select>
                    </div>
                    <div>
                        <label class="block text-xs font-semibold text-[var(--text-muted)] uppercase tracking-wide mb-1.5">Transport</label>
                        <select id="dayTransport" multiple class="form-input h-24"></select>
                        <p class="text-xs text-[var(--text-muted)] mt-1">Hold Ctrl/Cmd to select multiple</p>
                    </div>
                    <div>
                        <label class="block text-xs font-semibold text-[var(--text-muted)] uppercase tracking-wide mb-1.5">Activities (one per line)</label>
                        <textarea id="dayActivities" rows="4" class="form-input" placeholder="Morning coffee at local cafe&#10;Visit museum&#10;Lunch at..."></textarea>
                    </div>
                    <div>
                        <label class="block text-xs font-semibold text-[var(--text-muted)] uppercase tracking-wide mb-1.5">Notes</label>
                        <textarea id="dayNotes" rows="2" class="form-input" placeholder="Any additional notes..."></textarea>
                    </div>
                </form>
            </div>
            <!-- Footer Actions -->
            <div class="flex gap-3 p-4 border-t border-[var(--border-color)] bg-[var(--bg-light)] rounded-b-3xl">
                <button type="button" onclick="closeDayModal()" class="flex-1 btn btn-secondary">
                    <i class="fa-solid fa-xmark"></i> Cancel
                </button>
                <button type="submit" form="dayForm" class="flex-1 btn btn-primary">
                    <i class="fa-solid fa-check"></i> Save Day
                </button>
            </div>
        </div>
    </div>

    <!-- Hotel Modal -->
    <div id="hotelModal" class="modal">
        <div class="modal-content">
            <!-- Professional Header -->
            <div class="flex items-center justify-between p-4 bg-gradient-to-r from-[var(--primary)] to-[var(--secondary)] text-white rounded-t-3xl">
                <div class="flex items-center gap-3">
                    <div class="w-10 h-10 bg-white/20 rounded-xl flex items-center justify-center">
                        <i class="fa-solid fa-hotel"></i>
                    </div>
                    <div>
                        <h3 class="text-lg font-bold" id="hotelModalTitle">Add Hotel</h3>
                        <p class="text-xs text-white/70">Accommodation details</p>
                    </div>
                </div>
                <button onclick="closeHotelModal()" class="w-8 h-8 rounded-lg bg-white/20 hover:bg-red-500/80 flex items-center justify-center transition-colors">
                    <i class="fa-solid fa-xmark"></i>
                </button>
            </div>
            <!-- Form Content -->
            <div class="p-5 max-h-[70vh] overflow-y-auto">
                <form id="hotelForm" class="space-y-4">
                    <input type="hidden" id="hotelId">
                    <div>
                        <label class="block text-xs font-semibold text-[var(--text-muted)] uppercase tracking-wide mb-1.5">Hotel Name</label>
                        <input type="text" id="hotelName" required class="form-input" placeholder="e.g., Grand Hotel">
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-xs font-semibold text-[var(--text-muted)] uppercase tracking-wide mb-1.5">City</label>
                            <input type="text" id="hotelCity" required class="form-input" placeholder="e.g., Paris">
                        </div>
                        <div>
                            <label class="block text-xs font-semibold text-[var(--text-muted)] uppercase tracking-wide mb-1.5">Address</label>
                            <input type="text" id="hotelAddress" class="form-input" placeholder="Full address">
                        </div>
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-xs font-semibold text-[var(--text-muted)] uppercase tracking-wide mb-1.5">Check-in</label>
                            <input type="text" id="hotelCheckIn" required class="form-input" placeholder="DD/MM/YYYY" maxlength="10">
                        </div>
                        <div>
                            <label class="block text-xs font-semibold text-[var(--text-muted)] uppercase tracking-wide mb-1.5">Check-out</label>
                            <input type="text" id="hotelCheckOut" required class="form-input" placeholder="DD/MM/YYYY" maxlength="10">
                        </div>
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-xs font-semibold text-[var(--text-muted)] uppercase tracking-wide mb-1.5">Booking Reference</label>
                            <input type="text" id="hotelReference" class="form-input" placeholder="e.g., BK-12345">
                        </div>
                        <div>
                            <label class="block text-xs font-semibold text-[var(--text-muted)] uppercase tracking-wide mb-1.5">Contact</label>
                            <input type="text" id="hotelContact" class="form-input" placeholder="Phone or email">
                        </div>
                    </div>
                    <div>
                        <label class="block text-xs font-semibold text-[var(--text-muted)] uppercase tracking-wide mb-1.5">Documents</label>
                        <div class="file-upload-zone" id="hotelUploadZone" onclick="document.getElementById('hotelFiles').click()">
                            <input type="file" id="hotelFiles" accept="image/*,.pdf" multiple class="hidden" onchange="handleHotelFileSelect(event)">
                            <div class="text-center py-4">
                                <div class="w-12 h-12 mx-auto mb-2 rounded-xl bg-gradient-to-br from-[var(--primary)] to-[var(--secondary)] flex items-center justify-center text-white text-xl">
                                    <i class="fa-solid fa-cloud-arrow-up"></i>
                                </div>
                                <p class="font-semibold text-sm text-[var(--text-primary)]">Click to upload</p>
                                <p class="text-xs text-[var(--text-muted)]">Images & PDFs</p>
                            </div>
                        </div>
                        <div id="hotelFilesGallery" class="file-gallery mt-3"></div>
                    </div>
                </form>
            </div>
            <!-- Footer Actions -->
            <div class="flex gap-3 p-4 border-t border-[var(--border-color)] bg-[var(--bg-light)] rounded-b-3xl">
                <button type="button" onclick="closeHotelModal()" class="flex-1 btn btn-secondary">
                    <i class="fa-solid fa-xmark"></i> Cancel
                </button>
                <button type="submit" form="hotelForm" class="flex-1 btn btn-primary">
                    <i class="fa-solid fa-check"></i> Save Hotel
                </button>
            </div>
        </div>
    </div>

    <!-- Transport Modal -->
    <div id="transportModal" class="modal">
        <div class="modal-content">
            <!-- Professional Header -->
            <div class="flex items-center justify-between p-4 bg-gradient-to-r from-[var(--primary)] to-[var(--secondary)] text-white rounded-t-3xl">
                <div class="flex items-center gap-3">
                    <div class="w-10 h-10 bg-white/20 rounded-xl flex items-center justify-center">
                        <i class="fa-solid fa-train"></i>
                    </div>
                    <div>
                        <h3 class="text-lg font-bold" id="transportModalTitle">Add Transport</h3>
                        <p class="text-xs text-white/70">Travel booking details</p>
                    </div>
                </div>
                <button onclick="closeTransportModal()" class="w-8 h-8 rounded-lg bg-white/20 hover:bg-red-500/80 flex items-center justify-center transition-colors">
                    <i class="fa-solid fa-xmark"></i>
                </button>
            </div>
            <!-- Form Content -->
            <div class="p-5 max-h-[70vh] overflow-y-auto">
                <form id="transportForm" class="space-y-4">
                    <input type="hidden" id="transportId">
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-xs font-semibold text-[var(--text-muted)] uppercase tracking-wide mb-1.5">Date</label>
                            <input type="text" id="transportDate" required class="form-input" placeholder="DD/MM/YYYY" maxlength="10">
                        </div>
                        <div>
                            <label class="block text-xs font-semibold text-[var(--text-muted)] uppercase tracking-wide mb-1.5">Type</label>
                            <select id="transportType" required class="form-input">
                                <option value="flight">‚úàÔ∏è Flight</option>
                                <option value="train">üöÜ Train</option>
                                <option value="bus">üöå Bus</option>
                                <option value="boat">‚õ¥Ô∏è Boat / Ferry</option>
                            </select>
                        </div>
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-xs font-semibold text-[var(--text-muted)] uppercase tracking-wide mb-1.5">From</label>
                            <input type="text" id="transportFrom" required class="form-input" placeholder="Departure city">
                        </div>
                        <div>
                            <label class="block text-xs font-semibold text-[var(--text-muted)] uppercase tracking-wide mb-1.5">To</label>
                            <input type="text" id="transportTo" required class="form-input" placeholder="Arrival city">
                        </div>
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-xs font-semibold text-[var(--text-muted)] uppercase tracking-wide mb-1.5">Departure</label>
                            <input type="time" id="transportDeparture" required class="form-input">
                        </div>
                        <div>
                            <label class="block text-xs font-semibold text-[var(--text-muted)] uppercase tracking-wide mb-1.5">Arrival</label>
                            <input type="time" id="transportArrival" required class="form-input">
                        </div>
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-xs font-semibold text-[var(--text-muted)] uppercase tracking-wide mb-1.5">Seat / Coach</label>
                            <input type="text" id="transportSeat" class="form-input" placeholder="e.g., Car 4, Seat 25">
                        </div>
                        <div>
                            <label class="block text-xs font-semibold text-[var(--text-muted)] uppercase tracking-wide mb-1.5">Reference</label>
                            <input type="text" id="transportReference" class="form-input" placeholder="e.g., TKT-123456">
                        </div>
                    </div>
                    <div>
                        <label class="block text-xs font-semibold text-[var(--text-muted)] uppercase tracking-wide mb-1.5">Notes</label>
                        <textarea id="transportNotes" rows="2" class="form-input" placeholder="Platform, gate, etc."></textarea>
                    </div>
                    <div>
                        <label class="block text-xs font-semibold text-[var(--text-muted)] uppercase tracking-wide mb-1.5">Documents</label>
                        <div class="file-upload-zone" id="transportUploadZone" onclick="document.getElementById('transportFiles').click()">
                            <input type="file" id="transportFiles" accept="image/*,.pdf" multiple class="hidden" onchange="handleTransportFileSelect(event)">
                            <div class="text-center py-4">
                                <div class="w-12 h-12 mx-auto mb-2 rounded-xl bg-gradient-to-br from-[var(--primary)] to-[var(--secondary)] flex items-center justify-center text-white text-xl">
                                    <i class="fa-solid fa-cloud-arrow-up"></i>
                                </div>
                                <p class="font-semibold text-sm text-[var(--text-primary)]">Click to upload</p>
                                <p class="text-xs text-[var(--text-muted)]">Images & PDFs</p>
                            </div>
                        </div>
                        <div id="transportFilesGallery" class="file-gallery mt-3"></div>
                    </div>
                </form>
            </div>
            <!-- Footer Actions -->
            <div class="flex gap-3 p-4 border-t border-[var(--border-color)] bg-[var(--bg-light)] rounded-b-3xl">
                <button type="button" onclick="closeTransportModal()" class="flex-1 btn btn-secondary">
                    <i class="fa-solid fa-xmark"></i> Cancel
                </button>
                <button type="submit" form="transportForm" class="flex-1 btn btn-primary">
                    <i class="fa-solid fa-check"></i> Save Transport
                </button>
            </div>
        </div>
    </div>

    <!-- Firebase Settings Modal -->
    <div id="firebaseSettingsModal" class="modal">
        <div class="modal-content max-w-md">
            <!-- Professional Header -->
            <div class="flex items-center justify-between p-4 bg-gradient-to-r from-[var(--primary)] to-[var(--secondary)] text-white rounded-t-3xl">
                <div class="flex items-center gap-3">
                    <div class="w-10 h-10 bg-white/20 rounded-xl flex items-center justify-center">
                        <i class="fa-solid fa-database"></i>
                    </div>
                    <div>
                        <h3 class="text-lg font-bold">Database Settings</h3>
                        <p class="text-xs text-white/70">Manage your data</p>
                    </div>
                </div>
                <button onclick="closeFirebaseSettings()" class="w-8 h-8 rounded-lg bg-white/20 hover:bg-red-500/80 flex items-center justify-center transition-colors">
                    <i class="fa-solid fa-xmark"></i>
                </button>
            </div>
            <!-- Content -->
            <div class="p-5 max-h-[70vh] overflow-y-auto">
                <div class="bg-[var(--bg-light)] rounded-xl p-4 mb-5">
                    <div class="text-xs font-semibold text-[var(--text-muted)] uppercase tracking-wide mb-2">Connection Status</div>
                    <div id="configDetails" class="space-y-2"></div>
                </div>

                <div class="text-xs font-semibold text-[var(--text-muted)] uppercase tracking-wide mb-3">Data Actions</div>
                <div class="space-y-2">
                    <button onclick="loadAlpineRomanceData()" class="w-full btn btn-success py-3">
                        <i class="fa-solid fa-mountain-sun"></i> Load Alpine Romance Trip
                    </button>
                    <button onclick="loadSampleData()" class="w-full btn btn-primary py-3">
                        <i class="fa-solid fa-database"></i> Load Sample Data
                    </button>
                    <button onclick="clearAllData()" class="w-full btn btn-danger py-3">
                        <i class="fa-solid fa-trash"></i> Clear All Data
                    </button>
                </div>

                <div class="text-xs font-semibold text-[var(--text-muted)] uppercase tracking-wide mb-3 mt-5">Configuration</div>
                <div class="space-y-2">
                    <button onclick="reconfigureFirebase()" class="w-full btn btn-secondary py-3">
                        <i class="fa-solid fa-gear"></i> Change Firebase Config
                    </button>
                    <button onclick="resetToDefaultConfig()" class="w-full btn btn-secondary py-3">
                        <i class="fa-solid fa-rotate-left"></i> Reset to Default
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- File Viewer Modal -->
    <div id="fileViewerModal" class="modal">
        <div class="modal-content file-viewer-modal">
            <!-- Header -->
            <div class="file-viewer-header">
                <div class="file-viewer-title-section">
                    <div class="file-viewer-icon" id="fileViewerIcon">
                        <i class="fa-solid fa-file-pdf"></i>
                    </div>
                    <div>
                        <h3 class="file-viewer-title" id="fileViewerTitle">Document</h3>
                        <div id="pdfPageInfo" class="file-viewer-page-info hidden">Page 1 of 1</div>
                    </div>
                </div>
                <div class="file-viewer-actions">
                    <!-- PDF Navigation -->
                    <div id="pdfNavigation" class="file-viewer-nav hidden">
                        <button onclick="pdfPrevPage()" class="file-nav-btn" title="Previous"><i class="fa-solid fa-chevron-left"></i></button>
                        <button onclick="pdfNextPage()" class="file-nav-btn" title="Next"><i class="fa-solid fa-chevron-right"></i></button>
                        <div class="file-nav-divider"></div>
                        <button onclick="pdfZoomOut()" class="file-nav-btn" title="Zoom Out"><i class="fa-solid fa-minus"></i></button>
                        <button onclick="pdfZoomIn()" class="file-nav-btn" title="Zoom In"><i class="fa-solid fa-plus"></i></button>
                    </div>
                    <!-- Action Buttons -->
                    <div class="file-action-buttons">
                        <button onclick="printCurrentFile()" class="file-action-btn" title="Print">
                            <i class="fa-solid fa-print"></i>
                            <span class="file-action-label">Print</span>
                        </button>
                        <button onclick="downloadCurrentFile()" class="file-action-btn" title="Download">
                            <i class="fa-solid fa-download"></i>
                            <span class="file-action-label">Download</span>
                        </button>
                    </div>
                    <button onclick="closeFileViewer()" class="file-close-btn" title="Close">
                        <i class="fa-solid fa-xmark"></i>
                    </button>
                </div>
            </div>
            
            <!-- Content -->
            <div id="fileViewerContent" class="file-viewer-content">
                <canvas id="pdfCanvas" class="pdf-canvas hidden"></canvas>
                <img id="imageViewer" class="image-viewer hidden">
                <div id="fileLoading" class="file-loading hidden">
                    <div class="file-loading-spinner"></div>
                    <p>Loading document...</p>
                </div>
                <div id="fileError" class="file-error hidden">
                    <i class="fa-solid fa-exclamation-circle"></i>
                    <p id="fileErrorMessage">Unable to load file</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Gallery Modal -->
    <div id="galleryModal" class="modal">
        <div class="modal-content max-w-4xl">
            <!-- Professional Header -->
            <div class="flex items-center justify-between p-4 bg-gradient-to-r from-[var(--primary)] to-[var(--secondary)] text-white rounded-t-3xl">
                <div class="flex items-center gap-3">
                    <div class="w-10 h-10 bg-white/20 rounded-xl flex items-center justify-center">
                        <i class="fa-solid fa-images"></i>
                    </div>
                    <div>
                        <h3 class="text-lg font-bold">Photo Gallery</h3>
                        <p class="text-xs text-white/70">Click image to view full size</p>
                    </div>
                </div>
                <button onclick="closeGallery()" class="w-8 h-8 rounded-lg bg-white/20 hover:bg-red-500/80 flex items-center justify-center transition-colors">
                    <i class="fa-solid fa-xmark"></i>
                </button>
            </div>
            <!-- Content -->
            <div class="p-5 max-h-[70vh] overflow-y-auto">
                <div id="galleryContent" class="grid grid-cols-2 md:grid-cols-3 gap-4"></div>
            </div>
        </div>
    </div>

    <script>
        // Firebase Configuration
        let firebaseApp = null;
        let database = null;
        let isOnline = false;
        let dataCache = { days: {}, hotels: {}, transport: {}, files: {} };

        const FIREBASE_CONFIG_KEY = 'travelplan_firebase_config';
        const SETTINGS_KEY = 'travelplan_settings';

        const DEFAULT_FIREBASE_CONFIG = {
            apiKey: "AIzaSyCCBwBUlP9ofAOAOXtQUfXsXmlUjXAo7XU",
            authDomain: "switzerland-2a2cb.firebaseapp.com",
            databaseURL: "https://switzerland-2a2cb-default-rtdb.firebaseio.com",
            projectId: "switzerland-2a2cb",
            storageBucket: "switzerland-2a2cb.firebasestorage.app",
            messagingSenderId: "955702821704",
            appId: "1:955702821704:web:3d8241b6dc784c43bce97d"
        };

        function getSavedFirebaseConfig() {
            const config = localStorage.getItem(FIREBASE_CONFIG_KEY);
            return config ? JSON.parse(config) : DEFAULT_FIREBASE_CONFIG;
        }

        function saveFirebaseConfig(config) {
            localStorage.setItem(FIREBASE_CONFIG_KEY, JSON.stringify(config));
        }

        function switchConfigTab(tab) {
            const jsonTab = document.getElementById('jsonConfigTab');
            const manualForm = document.getElementById('firebaseConfigForm');
            const jsonBtn = document.getElementById('jsonTabBtn');
            const manualBtn = document.getElementById('manualTabBtn');

            if (tab === 'json') {
                jsonTab.classList.remove('hidden');
                manualForm.classList.add('hidden');
                jsonBtn.classList.add('bg-[var(--bg-card)]', 'shadow-sm');
                jsonBtn.classList.remove('text-[var(--text-muted)]');
                manualBtn.classList.remove('bg-[var(--bg-card)]', 'shadow-sm');
                manualBtn.classList.add('text-[var(--text-muted)]');
            } else {
                jsonTab.classList.add('hidden');
                manualForm.classList.remove('hidden');
                manualBtn.classList.add('bg-[var(--bg-card)]', 'shadow-sm');
                manualBtn.classList.remove('text-[var(--text-muted)]');
                jsonBtn.classList.remove('bg-[var(--bg-card)]', 'shadow-sm');
                jsonBtn.classList.add('text-[var(--text-muted)]');
            }
        }

        async function connectWithJson() {
            const jsonInput = document.getElementById('configJsonInput').value.trim();
            if (!jsonInput) { showConfigError('Please paste your Firebase config'); return; }

            try {
                let configStr = jsonInput;
                if (configStr.includes('=')) configStr = configStr.substring(configStr.indexOf('{'));
                configStr = configStr.replace(/;[\s]*$/, '');
                const config = JSON.parse(configStr);
                if (!config.apiKey || !config.projectId) throw new Error('Missing required fields');
                if (!config.databaseURL) config.databaseURL = `https://${config.projectId}-default-rtdb.firebaseio.com`;
                await initFirebase(config);
            } catch (error) {
                showConfigError('Invalid JSON: ' + error.message);
            }
        }

        async function initFirebase(config) {
            try {
                showLoading('Connecting to database...');
                firebaseApp = firebase.initializeApp(config);
                database = firebase.database();

                database.ref('.info/connected').on('value', (snap) => {
                    isOnline = snap.val() === true;
                    updateSyncStatus();
                });

                setupRealtimeListeners();
                saveFirebaseConfig(config);
                hideLoading();
                document.getElementById('firebaseConfigModal').classList.remove('active');
                return true;
            } catch (error) {
                hideLoading();
                showConfigError(error.message);
                return false;
            }
        }

        function setupRealtimeListeners() {
            database.ref('days').on('value', (snapshot) => {
                dataCache.days = snapshot.val() || {};
                localStorage.setItem('travelplan_offline_data', JSON.stringify(dataCache));
                renderAll();
                updateSelects();
            });

            database.ref('hotels').on('value', (snapshot) => {
                dataCache.hotels = snapshot.val() || {};
                localStorage.setItem('travelplan_offline_data', JSON.stringify(dataCache));
                renderAll();
                updateSelects();
            });

            database.ref('transport').on('value', (snapshot) => {
                dataCache.transport = snapshot.val() || {};
                localStorage.setItem('travelplan_offline_data', JSON.stringify(dataCache));
                renderAll();
                updateSelects();
            });

            database.ref('files').on('value', (snapshot) => {
                dataCache.files = snapshot.val() || {};
                localStorage.setItem('travelplan_offline_data', JSON.stringify(dataCache));
                // Re-render to show documents after files load
                renderHotels();
                renderTransportGuide();
            });
        }

        function updateSyncStatus() {
            const sidebarStatus = document.getElementById('sidebarSyncStatus');
            const mobileStatus = document.getElementById('mobileSyncStatus');
            
            if (isOnline) {
                sidebarStatus.className = 'sync-badge sync-connected';
                sidebarStatus.innerHTML = '<div class="pulse-dot"></div><span>Connected</span>';
                mobileStatus.className = 'sync-badge sync-connected';
                mobileStatus.innerHTML = '<div class="pulse-dot"></div>';
            } else {
                sidebarStatus.className = 'sync-badge sync-syncing';
                sidebarStatus.innerHTML = '<i class="fa-solid fa-rotate animate-spin"></i><span>Reconnecting</span>';
                mobileStatus.className = 'sync-badge sync-syncing';
                mobileStatus.innerHTML = '<i class="fa-solid fa-rotate animate-spin"></i>';
            }
        }

        function showLoading(text) {
            document.getElementById('loadingText').textContent = text;
            document.getElementById('loadingOverlay').classList.remove('hidden');
        }

        function hideLoading() {
            document.getElementById('loadingOverlay').classList.add('hidden');
        }

        function showConfigError(message) {
            const errorEl = document.getElementById('configError');
            errorEl.textContent = message;
            errorEl.classList.remove('hidden');
        }

        document.getElementById('firebaseConfigForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const config = {
                apiKey: document.getElementById('configApiKey').value,
                authDomain: document.getElementById('configAuthDomain').value,
                databaseURL: document.getElementById('configDatabaseURL').value,
                projectId: document.getElementById('configProjectId').value,
                storageBucket: document.getElementById('configStorageBucket').value || undefined
            };
            await initFirebase(config);
        });

        // CRUD Operations
        function generateId() { return Date.now().toString(36) + Math.random().toString(36).substr(2); }

        function getDays() { return Object.values(dataCache.days || {}).sort((a, b) => new Date(a.date) - new Date(b.date)); }
        function getHotels() { return Object.values(dataCache.hotels || {}).sort((a, b) => new Date(a.checkIn) - new Date(b.checkIn)); }
        function getTransport() { return Object.values(dataCache.transport || {}).sort((a, b) => new Date(a.date) - new Date(b.date) || a.departureTime.localeCompare(b.departureTime)); }

        async function saveDay(day) { await database.ref('days/' + day.id).set(day); }
        async function deleteDay(id) { if (confirm('Delete this day?')) await database.ref('days/' + id).remove(); }
        async function saveHotel(hotel) { await database.ref('hotels/' + hotel.id).set(hotel); }
        async function deleteHotel(id) { if (confirm('Delete this hotel?')) await database.ref('hotels/' + id).remove(); }
        async function saveTransport(transport) { await database.ref('transport/' + transport.id).set(transport); }
        async function deleteTransport(id) { if (confirm('Delete this transport?')) await database.ref('transport/' + id).remove(); }
        async function saveFile(id, data, type, name) { await database.ref('files/' + id).set({ id, data, type, name }); return id; }
        async function getFile(id) { return dataCache.files[id] || null; }
        async function deleteFile(id) { await database.ref('files/' + id).remove(); }

        function fileToBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = () => resolve(reader.result);
                reader.onerror = reject;
                reader.readAsDataURL(file);
            });
        }

        // Rendering
        function formatDate(dateStr) {
            const date = new Date(dateStr);
            const day = String(date.getDate()).padStart(2, '0');
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const year = date.getFullYear();
            const weekday = date.toLocaleDateString('en-US', { weekday: 'short' });
            return `${weekday}, ${day}/${month}/${year}`;
        }

        function formatShortDate(dateStr) {
            const date = new Date(dateStr);
            const day = String(date.getDate()).padStart(2, '0');
            const month = String(date.getMonth() + 1).padStart(2, '0');
            return `${day}/${month}`;
        }
        
        function formatFullDate(dateStr) {
            const date = new Date(dateStr);
            const day = String(date.getDate()).padStart(2, '0');
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const year = date.getFullYear();
            return `${day}/${month}/${year}`;
        }

        // Convert ISO date (YYYY-MM-DD) to display format (DD/MM/YYYY)
        function toDisplayDate(isoDate) {
            if (!isoDate) return '';
            const parts = isoDate.split('-');
            if (parts.length !== 3) return isoDate;
            return `${parts[2]}/${parts[1]}/${parts[0]}`;
        }

        // Convert display format (DD/MM/YYYY) to ISO date (YYYY-MM-DD)
        function toISODate(displayDate) {
            if (!displayDate) return '';
            const parts = displayDate.split('/');
            if (parts.length !== 3) return displayDate;
            return `${parts[2]}-${parts[1]}-${parts[0]}`;
        }

        // Format date input as user types
        function formatDateInput(input) {
            let value = input.value.replace(/\D/g, '');
            if (value.length >= 2) {
                value = value.substring(0, 2) + '/' + value.substring(2);
            }
            if (value.length >= 5) {
                value = value.substring(0, 5) + '/' + value.substring(5, 9);
            }
            input.value = value;
        }

        // Initialize date inputs with Flatpickr
        function initDateInputs() {
            const dateInputs = document.querySelectorAll('input[placeholder="DD/MM/YYYY"]');
            dateInputs.forEach(input => {
                // Initialize Flatpickr on each date input
                if (!input._flatpickr) {
                    flatpickr(input, {
                        dateFormat: "d/m/Y",
                        allowInput: true,
                        clickOpens: true,
                        disableMobile: false,
                        animate: true,
                        onReady: function(selectedDates, dateStr, instance) {
                            // Add calendar icon to the input
                            const wrapper = document.createElement('div');
                            wrapper.className = 'relative';
                            input.parentNode.insertBefore(wrapper, input);
                            wrapper.appendChild(input);
                        }
                    });
                }
                
                // Also allow manual typing with auto-format
                input.addEventListener('input', function(e) {
                    // Only format if user is typing (not selecting from picker)
                    if (!e.inputType) return;
                    formatDateInput(this);
                });
            });
        }
        
        // Re-initialize date pickers when modals open
        function initModalDatePickers() {
            setTimeout(() => {
                const dateInputs = document.querySelectorAll('.modal.active input[placeholder="DD/MM/YYYY"]');
                dateInputs.forEach(input => {
                    if (!input._flatpickr) {
                        flatpickr(input, {
                            dateFormat: "d/m/Y",
                            allowInput: true,
                            clickOpens: true,
                            disableMobile: false,
                            animate: true
                        });
                    }
                });
            }, 100);
        }

        function getTransportIcon(type) {
            const icons = { flight: 'fa-plane', train: 'fa-train', bus: 'fa-bus', boat: 'fa-ship' };
            return icons[type] || 'fa-car';
        }

        function renderDashboard() {
            const days = getDays();
            const hotels = getHotels();
            const transports = getTransport();
            const cities = [...new Set(days.map(d => d.city))];

            document.getElementById('statDays').textContent = days.length;
            document.getElementById('statHotels').textContent = hotels.length;
            document.getElementById('statTransport').textContent = transports.length;
            document.getElementById('statCities').textContent = cities.length;
            
            const banner = document.getElementById('loadTripBanner');
            if (banner) banner.style.display = (days.length === 0 && hotels.length === 0) ? 'block' : 'none';

            const upcomingContainer = document.getElementById('upcomingDays');
            const upcomingDays = days.slice(0, 5);
            
            if (upcomingDays.length === 0) {
                upcomingContainer.innerHTML = `<div class="empty-state py-8"><div class="empty-icon"><i class="fa-solid fa-calendar-plus"></i></div><p>No days planned yet</p></div>`;
            } else {
                upcomingContainer.innerHTML = upcomingDays.map(day => {
                    const hotel = hotels.find(h => h.id === day.hotelId);
                    const date = new Date(day.date);
                    const dayNum = String(date.getDate()).padStart(2, '0');
                    const monthNum = String(date.getMonth() + 1).padStart(2, '0');
                    return `
                        <div class="upcoming-item" onclick="goToDay('${day.id}')">
                            <div class="upcoming-date">
                                <span class="month">${dayNum}/${monthNum}</span>
                                <span class="day">${date.getFullYear()}</span>
                            </div>
                            <div class="flex-1 min-w-0">
                                <div class="font-bold text-lg">${day.city}</div>
                                <div class="text-sm text-[var(--text-secondary)]">${hotel ? hotel.name : `${(day.activities || []).length} activities`}</div>
                            </div>
                            <i class="fa-solid fa-chevron-right text-[var(--text-muted)]"></i>
                        </div>`;
                }).join('');
            }

            const transportContainer = document.getElementById('recentTransport');
            const recentTransport = transports.slice(0, 4);
            
            if (recentTransport.length === 0) {
                transportContainer.innerHTML = `<div class="empty-state py-8"><div class="empty-icon"><i class="fa-solid fa-train"></i></div><p>No transport bookings yet</p></div>`;
            } else {
                transportContainer.innerHTML = recentTransport.map(t => `
                    <div class="flex items-center gap-4 p-4 rounded-xl hover:bg-[var(--bg-light)] transition-colors">
                        <div class="w-12 h-12 rounded-xl flex items-center justify-center transport-${t.type}">
                            <i class="fa-solid ${getTransportIcon(t.type)} text-lg"></i>
                        </div>
                        <div class="flex-1 min-w-0">
                            <div class="font-bold">${t.from} ‚Üí ${t.to}</div>
                            <div class="text-sm text-[var(--text-secondary)]">${formatFullDate(t.date)} ¬∑ ${t.departureTime}</div>
                        </div>
                        <span class="transport-badge transport-${t.type} capitalize">${t.type}</span>
                    </div>`).join('');
            }
        }

        function toggleDay(id) {
            const content = document.getElementById(`day-content-${id}`);
            const chevron = document.getElementById(`chevron-${id}`);
            const header = document.getElementById(`day-header-${id}`);
            
            if (content.classList.contains('hidden')) {
                // Open
                content.classList.remove('hidden');
                // Small animation delay to allow display:block to apply before opacity
                requestAnimationFrame(() => {
                    content.classList.remove('opacity-0', '-translate-y-2');
                });
                chevron.style.transform = 'rotate(180deg)';
                header.classList.add('rounded-b-none');
            } else {
                // Close
                content.classList.add('opacity-0', '-translate-y-2');
                // Wait for transition to finish before hiding (approximate)
                setTimeout(() => {
                    content.classList.add('hidden');
                }, 200);
                chevron.style.transform = 'rotate(0deg)';
                header.classList.remove('rounded-b-none');
            }
        }

        function goToDay(dayId) {
            // 1. Reset search to ensure day is visible
            const searchInput = document.getElementById('searchInput');
            if (searchInput) {
                searchInput.value = '';
                filterItems();
            }

            // 2. Switch Tab
            switchTab('itinerary');

            // 3. Scroll and Expand (small delay to ensure DOM is ready/visible)
            setTimeout(() => {
                const dayHeader = document.getElementById(`day-header-${dayId}`);
                const dayContent = document.getElementById(`day-content-${dayId}`);
                
                if (dayHeader && dayContent) {
                    // Scroll into view
                    dayHeader.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    
                    // Expand if currently hidden
                    if (dayContent.classList.contains('hidden')) {
                        toggleDay(dayId);
                    }
                }
            }, 100);
        }

        function renderItinerary() {
            const container = document.getElementById('itineraryContainer');
            const days = getDays();
            const hotels = getHotels();
            const transports = getTransport();
            const searchTerm = document.getElementById('searchInput')?.value?.toLowerCase() || '';

            let filteredDays = days.filter(day => 
                !searchTerm || day.city.toLowerCase().includes(searchTerm) || 
                (day.activities || []).some(a => a.toLowerCase().includes(searchTerm))
            );

            if (filteredDays.length === 0) {
                container.innerHTML = `<div class="empty-state"><div class="empty-icon"><i class="fa-solid fa-calendar-plus"></i></div><h3 class="text-xl font-bold mb-2">No Days Found</h3><p class="mb-5">Start building your travel itinerary</p><button onclick="openDayModal()" class="btn btn-primary"><i class="fa-solid fa-plus"></i> Add First Day</button></div>`;
                return;
            }

            container.innerHTML = filteredDays.map(day => {
                const hotel = hotels.find(h => h.id === day.hotelId);
                const dayTransports = (day.transportIds || []).map(id => transports.find(t => t.id === id)).filter(Boolean);
                
                return `
                    <div class="timeline-item">
                        <div class="timeline-dot"></div>
                        <div class="card overflow-hidden">
                            <!-- Header (Clickable) -->
                            <div id="day-header-${day.id}" class="day-header cursor-pointer transition-all duration-200 hover:bg-opacity-80" onclick="toggleDay('${day.id}')">
                                <div class="flex justify-between items-start">
                                    <div>
                                        <div class="text-sm font-semibold text-[var(--primary)] mb-1">${formatDate(day.date)}</div>
                                        <h3 class="text-xl font-bold flex items-center gap-2">
                                            <i class="fa-solid fa-location-dot text-[var(--secondary)]"></i>
                                            ${day.city}
                                        </h3>
                                        ${hotel ? `<div class="text-xs text-[var(--text-secondary)] mt-1"><i class="fa-solid fa-bed mr-1"></i>${hotel.name}</div>` : ''}
                                    </div>
                                    <div class="flex items-center gap-3">
                                        <div class="flex gap-1" onclick="event.stopPropagation()">
                                            <button onclick="editDay('${day.id}')" class="action-btn" title="Edit"><i class="fa-solid fa-pen"></i></button>
                                            <button onclick="deleteDay('${day.id}')" class="action-btn danger" title="Delete"><i class="fa-solid fa-trash"></i></button>
                                        </div>
                                        <div class="w-8 h-8 flex items-center justify-center rounded-full bg-white/20">
                                            <i id="chevron-${day.id}" class="fa-solid fa-chevron-down transition-transform duration-300"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Content (Collapsible) -->
                            <div id="day-content-${day.id}" class="hidden opacity-0 -translate-y-2 transition-all duration-200 border-t border-[var(--border-color)]">
                                <div class="p-5">
                                    ${hotel ? `
                                        <div class="flex items-center gap-3 p-4 bg-gradient-to-r from-purple-50 to-indigo-50 dark:from-purple-900/20 dark:to-indigo-900/20 rounded-xl mb-4">
                                            <i class="fa-solid fa-hotel text-xl text-[var(--primary)]"></i>
                                            <div>
                                                <div class="font-bold">${hotel.name}</div>
                                                <div class="text-sm text-[var(--text-secondary)]">${hotel.address || hotel.city}</div>
                                            </div>
                                        </div>` : ''}

                                    ${dayTransports.length > 0 ? `
                                        <div class="space-y-3 mb-4">
                                            ${dayTransports.map(t => `
                                                <div class="transport-card ${t.type} card p-4">
                                                    <div class="flex items-center gap-3">
                                                        <i class="fa-solid ${getTransportIcon(t.type)} text-xl"></i>
                                                        <div class="flex-1">
                                                            <div class="font-bold">${t.from} ‚Üí ${t.to}</div>
                                                            <div class="text-sm text-[var(--text-secondary)]">${t.departureTime} - ${t.arrivalTime}</div>
                                                        </div>
                                                        <span class="transport-badge transport-${t.type} capitalize">${t.type}</span>
                                                    </div>
                                                </div>`).join('')}
                                        </div>` : ''}

                                    ${(day.activities || []).length > 0 ? `
                                        <div class="mb-4">
                                            <div class="section-title">Activities</div>
                                            ${day.activities.map(a => `
                                                <div class="activity-item">
                                                    <i class="fa-solid fa-circle"></i>
                                                    <span>${a}</span>
                                                </div>`).join('')}
                                        </div>` : ''}

                                    ${day.notes ? `
                                        <div class="p-4 bg-amber-50 dark:bg-amber-900/20 rounded-xl text-sm">
                                            <i class="fa-solid fa-sticky-note text-amber-500 mr-2"></i>
                                            ${day.notes}
                                        </div>` : ''}

                                    ${(day.images && day.images.length) || (day.documents && day.documents.length) ? `
                                        <div class="flex gap-3 mt-4 pt-4 border-t border-[var(--border-color)]">
                                            ${day.images?.length ? `<button onclick="showGallery('${day.id}')" class="info-badge hover:bg-[var(--border-color)] cursor-pointer"><i class="fa-solid fa-images"></i> ${day.images.length} images</button>` : ''}
                                            ${day.documents?.length ? `<button onclick="showDocuments('${day.id}')" class="info-badge hover:bg-[var(--border-color)] cursor-pointer"><i class="fa-solid fa-file-pdf"></i> ${day.documents.length} docs</button>` : ''}
                                        </div>` : ''}
                                </div>
                            </div>
                        </div>
                    </div>`;
            }).join('');
        }

        function renderHotels() {
            const container = document.getElementById('hotelsContainer');
            const hotels = getHotels();

            if (hotels.length === 0) {
                container.innerHTML = `<div class="col-span-full empty-state"><div class="empty-icon"><i class="fa-solid fa-hotel"></i></div><h3 class="text-xl font-bold mb-2">No Hotels</h3><p class="mb-5">Add your accommodations</p><button onclick="openHotelModal()" class="btn btn-primary"><i class="fa-solid fa-plus"></i> Add Hotel</button></div>`;
                return;
            }

            container.innerHTML = hotels.map(hotel => {
                const nights = Math.ceil((new Date(hotel.checkOut) - new Date(hotel.checkIn)) / (1000 * 60 * 60 * 24));
                return `
                    <div class="card hotel-card p-5">
                        <div class="flex justify-between items-start mb-4">
                            <div class="w-14 h-14 bg-gradient-to-br from-[var(--primary)] to-[var(--secondary)] rounded-2xl flex items-center justify-center text-white text-xl">
                                <i class="fa-solid fa-hotel"></i>
                            </div>
                            <div class="flex gap-1">
                                <button onclick="editHotel('${hotel.id}')" class="action-btn"><i class="fa-solid fa-pen"></i></button>
                                <button onclick="deleteHotel('${hotel.id}')" class="action-btn danger"><i class="fa-solid fa-trash"></i></button>
                            </div>
                        </div>
                        <h3 class="text-lg font-bold mb-1">${hotel.name}</h3>
                        <p class="text-[var(--text-secondary)] mb-4 flex items-center gap-2">
                            <i class="fa-solid fa-location-dot"></i> ${hotel.city}
                        </p>
                        ${hotel.address ? `<p class="text-sm text-[var(--text-muted)] mb-4">${hotel.address}</p>` : ''}
                        
                        <div class="flex items-center gap-3 text-sm mb-4 p-3 bg-[var(--bg-light)] rounded-xl">
                            <div class="text-center">
                                <div class="text-xs text-[var(--text-muted)]">Check-in</div>
                                <div class="font-bold">${formatFullDate(hotel.checkIn)}</div>
                            </div>
                            <i class="fa-solid fa-arrow-right text-[var(--text-muted)]"></i>
                            <div class="text-center">
                                <div class="text-xs text-[var(--text-muted)]">Check-out</div>
                                <div class="font-bold">${formatFullDate(hotel.checkOut)}</div>
                            </div>
                            <div class="ml-auto info-badge">${nights} nights</div>
                        </div>

                        ${hotel.reference ? `<div class="text-sm text-[var(--text-secondary)] mb-3"><i class="fa-solid fa-hashtag mr-2"></i>${hotel.reference}</div>` : ''}
                        ${hotel.contact ? `<div class="text-sm text-[var(--text-secondary)] mb-3"><i class="fa-solid fa-phone mr-2"></i>${hotel.contact}</div>` : ''}
                        ${(hotel.fileIds && hotel.fileIds.length > 0) || hotel.pdfId ? `
                            <div class="mt-4 pt-4 border-t border-[var(--border-color)]">
                                <div class="text-xs font-semibold text-[var(--text-muted)] uppercase mb-2">Documents</div>
                                <div class="flex flex-wrap gap-2">
                                    ${(hotel.fileIds || [hotel.pdfId].filter(Boolean)).map(fileId => {
                                        const file = dataCache.files[fileId];
                                        if (!file) return '';
                                        return file.type === 'image' 
                                            ? `<div onclick="viewFile('${fileId}')" class="w-12 h-12 rounded-lg overflow-hidden cursor-pointer hover:opacity-80 border-2 border-[var(--border-color)]"><img src="${file.data}" class="w-full h-full object-cover"></div>`
                                            : `<button onclick="viewFile('${fileId}')" class="info-badge hover:bg-[var(--border-color)] cursor-pointer"><i class="fa-solid fa-file-pdf text-red-500"></i> PDF</button>`;
                                    }).join('')}
                                </div>
                            </div>` : ''}
                    </div>`;
            }).join('');
        }

        function renderTransportGuide() {
            const container = document.getElementById('transportGuideContainer');
            const transports = getTransport();

            if (transports.length === 0) {
                container.innerHTML = `<div class="empty-state"><div class="empty-icon"><i class="fa-solid fa-train"></i></div><h3 class="text-xl font-bold mb-2">No Transport</h3><p class="mb-5">Add your travel bookings</p><button onclick="openTransportModal()" class="btn btn-primary"><i class="fa-solid fa-plus"></i> Add Transport</button></div>`;
                return;
            }

            container.innerHTML = transports.map(t => `
                <div class="card transport-card ${t.type} p-5">
                    <div class="flex flex-col md:flex-row md:items-center justify-between gap-4">
                        <div class="flex items-start gap-4">
                            <div class="w-14 h-14 rounded-2xl flex items-center justify-center transport-${t.type} text-2xl flex-shrink-0">
                                <i class="fa-solid ${getTransportIcon(t.type)}"></i>
                            </div>
                            <div>
                                <div class="text-sm font-semibold text-[var(--primary)] mb-1">${formatFullDate(t.date)}</div>
                                <h3 class="text-xl font-bold mb-1">${t.from} ‚Üí ${t.to}</h3>
                                <div class="flex items-center gap-4 text-[var(--text-secondary)]">
                                    <span><i class="fa-solid fa-clock mr-1"></i> ${t.departureTime} - ${t.arrivalTime}</span>
                                    <span class="transport-badge transport-${t.type} capitalize">${t.type}</span>
                                </div>
                            </div>
                        </div>
                        <div class="flex gap-2">
                            <button onclick="editTransport('${t.id}')" class="action-btn"><i class="fa-solid fa-pen"></i></button>
                            <button onclick="deleteTransport('${t.id}')" class="action-btn danger"><i class="fa-solid fa-trash"></i></button>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mt-5 pt-5 border-t border-[var(--border-color)]">
                        <div>
                            <span class="text-xs font-semibold text-[var(--text-muted)] uppercase tracking-wider block mb-1">Type</span>
                            <span class="font-semibold capitalize">${t.type}</span>
                        </div>
                        ${t.seat ? `<div><span class="text-xs font-semibold text-[var(--text-muted)] uppercase tracking-wider block mb-1">Seat</span><span class="font-semibold">${t.seat}</span></div>` : ''}
                        ${t.reference ? `<div><span class="text-xs font-semibold text-[var(--text-muted)] uppercase tracking-wider block mb-1">Reference</span><span class="font-semibold">${t.reference}</span></div>` : ''}
                    </div>
                    ${t.notes ? `<div class="mt-4 p-4 bg-[var(--bg-light)] rounded-xl text-sm"><i class="fa-solid fa-info-circle text-[var(--primary)] mr-2"></i>${t.notes}</div>` : ''}
                    ${(t.fileIds && t.fileIds.length > 0) || t.pdfId ? `
                        <div class="mt-4 pt-4 border-t border-[var(--border-color)]">
                            <div class="text-xs font-semibold text-[var(--text-muted)] uppercase mb-2">Documents</div>
                            <div class="flex flex-wrap gap-2">
                                ${(t.fileIds || [t.pdfId].filter(Boolean)).map(fileId => {
                                    const file = dataCache.files[fileId];
                                    if (!file) return '';
                                    return file.type === 'image' 
                                        ? `<div onclick="viewFile('${fileId}')" class="w-12 h-12 rounded-lg overflow-hidden cursor-pointer hover:opacity-80 border-2 border-[var(--border-color)]"><img src="${file.data}" class="w-full h-full object-cover"></div>`
                                        : `<button onclick="viewFile('${fileId}')" class="info-badge hover:bg-[var(--border-color)] cursor-pointer"><i class="fa-solid fa-file-pdf text-red-500"></i> PDF</button>`;
                                }).join('')}
                            </div>
                        </div>` : ''}
                </div>`).join('');
        }

        function renderTransportList() {
            const tbody = document.getElementById('transportListTable');
            const transports = getTransport();

            if (transports.length === 0) {
                tbody.innerHTML = `<tr><td colspan="5" class="text-center py-12 text-[var(--text-muted)]">No transport bookings yet</td></tr>`;
                return;
            }

            tbody.innerHTML = transports.map(t => `
                <tr>
                    <td class="font-bold">${formatFullDate(t.date)}</td>
                    <td class="font-semibold">${t.from} <span class="text-[var(--text-muted)]">‚Üí</span> ${t.to}</td>
                    <td><span class="transport-badge transport-${t.type} capitalize"><i class="fa-solid ${getTransportIcon(t.type)} mr-1"></i>${t.type}</span></td>
                    <td class="text-[var(--text-secondary)]">${t.departureTime} - ${t.arrivalTime}</td>
                    <td class="text-[var(--text-secondary)]">${t.notes || '-'}</td>
                </tr>`).join('');
        }

        function renderAll() {
            renderDashboard();
            renderItinerary();
            renderHotels();
            renderTransportGuide();
            renderTransportList();
        }

        // Modals
        function openDayModal(day = null) {
            document.getElementById('dayModal').classList.add('active');
            document.getElementById('dayModalTitle').textContent = day ? 'Edit Day' : 'Add Day';
            updateSelects();
            initModalDatePickers();
            
            if (day) {
                document.getElementById('dayId').value = day.id;
                document.getElementById('dayDate').value = toDisplayDate(day.date);
                document.getElementById('dayCity').value = day.city;
                document.getElementById('dayHotel').value = day.hotelId || '';
                document.getElementById('dayActivities').value = (day.activities || []).join('\n');
                document.getElementById('dayNotes').value = day.notes || '';
                Array.from(document.getElementById('dayTransport').options).forEach(opt => {
                    opt.selected = (day.transportIds || []).includes(opt.value);
                });
            } else {
                document.getElementById('dayForm').reset();
                document.getElementById('dayId').value = '';
            }
        }

        function closeDayModal() { document.getElementById('dayModal').classList.remove('active'); }
        function editDay(id) { const day = getDays().find(d => d.id === id); if (day) openDayModal(day); }

        function openHotelModal(hotel = null) {
            document.getElementById('hotelModal').classList.add('active');
            document.getElementById('hotelModalTitle').textContent = hotel ? 'Edit Hotel' : 'Add Hotel';
            initModalDatePickers();
            
            // Reset file arrays
            hotelPendingFiles = [];
            hotelExistingFiles = [];
            
            if (hotel) {
                document.getElementById('hotelId').value = hotel.id;
                document.getElementById('hotelName').value = hotel.name;
                document.getElementById('hotelCity').value = hotel.city;
                document.getElementById('hotelAddress').value = hotel.address || '';
                document.getElementById('hotelCheckIn').value = hotel.checkIn;
                document.getElementById('hotelCheckOut').value = hotel.checkOut;
                document.getElementById('hotelReference').value = hotel.reference || '';
                document.getElementById('hotelContact').value = hotel.contact || '';
                
                // Load existing files
                hotelExistingFiles = hotel.fileIds || [];
                // Also support legacy single pdfId
                if (hotel.pdfId && !hotelExistingFiles.includes(hotel.pdfId)) {
                    hotelExistingFiles.push(hotel.pdfId);
                }
            } else {
                document.getElementById('hotelForm').reset();
                document.getElementById('hotelId').value = '';
            }
            
            renderHotelFilesGallery();
        }

        function closeHotelModal() { 
            document.getElementById('hotelModal').classList.remove('active'); 
            hotelPendingFiles = [];
            hotelExistingFiles = [];
        }
        function editHotel(id) { const hotel = getHotels().find(h => h.id === id); if (hotel) openHotelModal(hotel); }

        // Hotel file handling
        let hotelPendingFiles = [];
        let hotelExistingFiles = [];

        async function handleHotelFileSelect(event) {
            const files = Array.from(event.target.files);
            for (const file of files) {
                const base64 = await fileToBase64(file);
                const isImage = file.type.startsWith('image/');
                hotelPendingFiles.push({
                    id: generateId(),
                    name: file.name,
                    type: isImage ? 'image' : 'pdf',
                    data: base64,
                    isNew: true
                });
            }
            renderHotelFilesGallery();
            event.target.value = '';
        }

        function removeHotelPendingFile(fileId) {
            hotelPendingFiles = hotelPendingFiles.filter(f => f.id !== fileId);
            renderHotelFilesGallery();
        }

        function removeHotelExistingFile(fileId) {
            hotelExistingFiles = hotelExistingFiles.filter(f => f !== fileId);
            renderHotelFilesGallery();
        }

        function renderHotelFilesGallery() {
            const gallery = document.getElementById('hotelFilesGallery');
            let html = '';

            // Pending new files
            for (const file of hotelPendingFiles) {
                if (file.type === 'image') {
                    html += `
                        <div class="file-gallery-item" onclick="viewFileData('${file.id}', true)">
                            <img src="${file.data}" alt="${file.name}">
                            <button class="remove-btn" onclick="event.stopPropagation(); removeHotelPendingFile('${file.id}')"><i class="fa-solid fa-xmark"></i></button>
                            <span class="file-type-badge">NEW</span>
                        </div>`;
                } else {
                    html += `
                        <div class="file-gallery-item" onclick="viewFileData('${file.id}', true)">
                            <div class="pdf-icon">
                                <i class="fa-solid fa-file-pdf"></i>
                                <span>${file.name}</span>
                            </div>
                            <button class="remove-btn" onclick="event.stopPropagation(); removeHotelPendingFile('${file.id}')"><i class="fa-solid fa-xmark"></i></button>
                            <span class="file-type-badge">NEW</span>
                        </div>`;
                }
            }

            // Existing files
            if (hotelExistingFiles.length > 0) {
                html += `<div class="col-span-full existing-files-section"><div class="existing-files-title"><i class="fa-solid fa-check-circle"></i> Saved Documents</div><div class="file-gallery">`;
                for (const fileId of hotelExistingFiles) {
                    const file = dataCache.files[fileId];
                    if (file) {
                        if (file.type === 'image') {
                            html += `
                                <div class="file-gallery-item" onclick="viewFile('${fileId}')">
                                    <img src="${file.data}" alt="${file.name}">
                                    <button class="remove-btn" onclick="event.stopPropagation(); removeHotelExistingFile('${fileId}')"><i class="fa-solid fa-xmark"></i></button>
                                </div>`;
                        } else {
                            html += `
                                <div class="file-gallery-item" onclick="viewFile('${fileId}')">
                                    <div class="pdf-icon">
                                        <i class="fa-solid fa-file-pdf"></i>
                                        <span>${file.name}</span>
                                    </div>
                                    <button class="remove-btn" onclick="event.stopPropagation(); removeHotelExistingFile('${fileId}')"><i class="fa-solid fa-xmark"></i></button>
                                </div>`;
                        }
                    }
                }
                html += `</div></div>`;
            }

            gallery.innerHTML = html;
        }

        async function viewFileData(fileId, isPending = false) {
            let file;
            if (isPending) {
                file = hotelPendingFiles.find(f => f.id === fileId) || transportPendingFiles.find(f => f.id === fileId);
            }
            if (!file) return;
            
            // Store current file info for print/download
            currentFileData = file.data;
            currentFileName = file.name || 'document';
            currentFileType = file.type;
            
            document.getElementById('fileViewerTitle').textContent = file.name || 'File';
            
            // Update icon based on file type
            const iconEl = document.getElementById('fileViewerIcon');
            if (file.type === 'pdf') {
                iconEl.innerHTML = '<i class="fa-solid fa-file-pdf"></i>';
                iconEl.style.background = 'rgba(239, 68, 68, 0.3)';
            } else {
                iconEl.innerHTML = '<i class="fa-solid fa-image"></i>';
                iconEl.style.background = 'rgba(16, 185, 129, 0.3)';
            }
            
            // Reset visibility
            document.getElementById('pdfCanvas').classList.add('hidden');
            document.getElementById('imageViewer').classList.add('hidden');
            document.getElementById('pdfNavigation').classList.add('hidden');
            document.getElementById('pdfPageInfo').classList.add('hidden');
            document.getElementById('fileLoading').classList.add('hidden');
            document.getElementById('fileError').classList.add('hidden');
            
            if (file.type === 'pdf') {
                // Show loading
                document.getElementById('fileLoading').classList.remove('hidden');
                document.getElementById('fileViewerModal').classList.add('active');
                
                try {
                    // Convert base64 to Uint8Array for PDF.js
                    const pdfData = base64ToUint8Array(file.data);
                    
                    // Load PDF using PDF.js
                    const loadingTask = pdfjsLib.getDocument({ data: pdfData });
                    currentPdf = await loadingTask.promise;
                    totalPages = currentPdf.numPages;
                    currentPage = 1;
                    currentScale = 1.5;
                    
                    // Hide loading, show canvas and navigation
                    document.getElementById('fileLoading').classList.add('hidden');
                    document.getElementById('pdfCanvas').classList.remove('hidden');
                    document.getElementById('pdfNavigation').classList.remove('hidden');
                    document.getElementById('pdfPageInfo').classList.remove('hidden');
                    
                    // Render first page
                    await renderPdfPage(currentPage);
                    
                } catch (error) {
                    console.error('Error loading PDF:', error);
                    document.getElementById('fileLoading').classList.add('hidden');
                    document.getElementById('fileError').classList.remove('hidden');
                    document.getElementById('fileErrorMessage').textContent = 'Unable to preview PDF';
                }
            } else {
                // For images
                const imageViewer = document.getElementById('imageViewer');
                imageViewer.src = file.data;
                imageViewer.classList.remove('hidden');
                document.getElementById('fileViewerModal').classList.add('active');
            }
        }

        function openTransportModal(transport = null) {
            document.getElementById('transportModal').classList.add('active');
            document.getElementById('transportModalTitle').textContent = transport ? 'Edit Transport' : 'Add Transport';
            initModalDatePickers();
            
            // Reset file arrays
            transportPendingFiles = [];
            transportExistingFiles = [];
            
            if (transport) {
                document.getElementById('transportId').value = transport.id;
                document.getElementById('transportDate').value = transport.date;
                document.getElementById('transportFrom').value = transport.from;
                document.getElementById('transportTo').value = transport.to;
                document.getElementById('transportType').value = transport.type;
                document.getElementById('transportDeparture').value = transport.departureTime;
                document.getElementById('transportArrival').value = transport.arrivalTime;
                document.getElementById('transportSeat').value = transport.seat || '';
                document.getElementById('transportReference').value = transport.reference || '';
                document.getElementById('transportNotes').value = transport.notes || '';
                
                // Load existing files
                transportExistingFiles = transport.fileIds || [];
                // Also support legacy single pdfId
                if (transport.pdfId && !transportExistingFiles.includes(transport.pdfId)) {
                    transportExistingFiles.push(transport.pdfId);
                }
            } else {
                document.getElementById('transportForm').reset();
                document.getElementById('transportId').value = '';
            }
            
            renderTransportFilesGallery();
        }

        function closeTransportModal() { 
            document.getElementById('transportModal').classList.remove('active'); 
            transportPendingFiles = [];
            transportExistingFiles = [];
        }
        function editTransport(id) { const t = getTransport().find(t => t.id === id); if (t) openTransportModal(t); }

        // Transport file handling
        let transportPendingFiles = [];
        let transportExistingFiles = [];

        async function handleTransportFileSelect(event) {
            const files = Array.from(event.target.files);
            for (const file of files) {
                const base64 = await fileToBase64(file);
                const isImage = file.type.startsWith('image/');
                transportPendingFiles.push({
                    id: generateId(),
                    name: file.name,
                    type: isImage ? 'image' : 'pdf',
                    data: base64,
                    isNew: true
                });
            }
            renderTransportFilesGallery();
            event.target.value = '';
        }

        function removeTransportPendingFile(fileId) {
            transportPendingFiles = transportPendingFiles.filter(f => f.id !== fileId);
            renderTransportFilesGallery();
        }

        function removeTransportExistingFile(fileId) {
            transportExistingFiles = transportExistingFiles.filter(f => f !== fileId);
            renderTransportFilesGallery();
        }

        function renderTransportFilesGallery() {
            const gallery = document.getElementById('transportFilesGallery');
            let html = '';

            // Pending new files
            for (const file of transportPendingFiles) {
                if (file.type === 'image') {
                    html += `
                        <div class="file-gallery-item" onclick="viewFileData('${file.id}', true)">
                            <img src="${file.data}" alt="${file.name}">
                            <button class="remove-btn" onclick="event.stopPropagation(); removeTransportPendingFile('${file.id}')"><i class="fa-solid fa-xmark"></i></button>
                            <span class="file-type-badge">NEW</span>
                        </div>`;
                } else {
                    html += `
                        <div class="file-gallery-item" onclick="viewFileData('${file.id}', true)">
                            <div class="pdf-icon">
                                <i class="fa-solid fa-file-pdf"></i>
                                <span>${file.name}</span>
                            </div>
                            <button class="remove-btn" onclick="event.stopPropagation(); removeTransportPendingFile('${file.id}')"><i class="fa-solid fa-xmark"></i></button>
                            <span class="file-type-badge">NEW</span>
                        </div>`;
                }
            }

            // Existing files
            if (transportExistingFiles.length > 0) {
                html += `<div class="col-span-full existing-files-section"><div class="existing-files-title"><i class="fa-solid fa-check-circle"></i> Saved Documents</div><div class="file-gallery">`;
                for (const fileId of transportExistingFiles) {
                    const file = dataCache.files[fileId];
                    if (file) {
                        if (file.type === 'image') {
                            html += `
                                <div class="file-gallery-item" onclick="viewFile('${fileId}')">
                                    <img src="${file.data}" alt="${file.name}">
                                    <button class="remove-btn" onclick="event.stopPropagation(); removeTransportExistingFile('${fileId}')"><i class="fa-solid fa-xmark"></i></button>
                                </div>`;
                        } else {
                            html += `
                                <div class="file-gallery-item" onclick="viewFile('${fileId}')">
                                    <div class="pdf-icon">
                                        <i class="fa-solid fa-file-pdf"></i>
                                        <span>${file.name}</span>
                                    </div>
                                    <button class="remove-btn" onclick="event.stopPropagation(); removeTransportExistingFile('${fileId}')"><i class="fa-solid fa-xmark"></i></button>
                                </div>`;
                        }
                    }
                }
                html += `</div></div>`;
            }

            gallery.innerHTML = html;
        }

        function updateSelects() {
            const hotels = getHotels();
            const transports = getTransport();

            ['dayHotel', 'builderHotel'].forEach(id => {
                const select = document.getElementById(id);
                if (select) {
                    const val = select.value;
                    select.innerHTML = '<option value="">Select hotel...</option>' + hotels.map(h => `<option value="${h.id}">${h.name} - ${h.city}</option>`).join('');
                    select.value = val;
                }
            });

            ['dayTransport', 'builderTransport'].forEach(id => {
                const select = document.getElementById(id);
                if (select) {
                    const selected = Array.from(select.selectedOptions).map(o => o.value);
                    select.innerHTML = transports.map(t => `<option value="${t.id}">${formatFullDate(t.date)} - ${t.from} ‚Üí ${t.to}</option>`).join('');
                    Array.from(select.options).forEach(opt => opt.selected = selected.includes(opt.value));
                }
            });
        }

        // Form Handlers
        document.getElementById('dayForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            const dayId = document.getElementById('dayId').value || generateId();
            const existingDay = getDays().find(d => d.id === dayId);
            
            await saveDay({
                id: dayId,
                date: toISODate(document.getElementById('dayDate').value),
                city: document.getElementById('dayCity').value,
                hotelId: document.getElementById('dayHotel').value || null,
                transportIds: Array.from(document.getElementById('dayTransport').selectedOptions).map(o => o.value),
                activities: document.getElementById('dayActivities').value.split('\n').filter(a => a.trim()),
                notes: document.getElementById('dayNotes').value,
                images: existingDay?.images || [],
                documents: existingDay?.documents || []
            });
            closeDayModal();
        });

        document.getElementById('hotelForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            const hotelId = document.getElementById('hotelId').value || generateId();
            
            // Collect all file IDs
            const allFileIds = [...hotelExistingFiles];
            
            // Save new pending files
            for (const file of hotelPendingFiles) {
                await saveFile(file.id, file.data, file.type, file.name);
                allFileIds.push(file.id);
            }
            
            const hotel = {
                id: hotelId,
                name: document.getElementById('hotelName').value,
                city: document.getElementById('hotelCity').value,
                address: document.getElementById('hotelAddress').value,
                checkIn: toISODate(document.getElementById('hotelCheckIn').value),
                checkOut: toISODate(document.getElementById('hotelCheckOut').value),
                reference: document.getElementById('hotelReference').value,
                contact: document.getElementById('hotelContact').value,
                fileIds: allFileIds,
                pdfId: allFileIds.length > 0 ? allFileIds[0] : null // Legacy support
            };

            await saveHotel(hotel);
            closeHotelModal();
        });

        document.getElementById('transportForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            const transportId = document.getElementById('transportId').value || generateId();
            
            // Collect all file IDs
            const allFileIds = [...transportExistingFiles];
            
            // Save new pending files
            for (const file of transportPendingFiles) {
                await saveFile(file.id, file.data, file.type, file.name);
                allFileIds.push(file.id);
            }
            
            const transport = {
                id: transportId,
                date: toISODate(document.getElementById('transportDate').value),
                from: document.getElementById('transportFrom').value,
                to: document.getElementById('transportTo').value,
                type: document.getElementById('transportType').value,
                departureTime: document.getElementById('transportDeparture').value,
                arrivalTime: document.getElementById('transportArrival').value,
                seat: document.getElementById('transportSeat').value,
                reference: document.getElementById('transportReference').value,
                notes: document.getElementById('transportNotes').value,
                fileIds: allFileIds,
                pdfId: allFileIds.length > 0 ? allFileIds[0] : null // Legacy support
            };

            await saveTransport(transport);
            closeTransportModal();
        });

        // Day Builder
        function addActivityInput() {
            const container = document.getElementById('activitiesContainer');
            const div = document.createElement('div');
            div.className = 'flex gap-2';
            div.innerHTML = `
                <input type="text" placeholder="Activity description" class="form-input flex-1">
                <button type="button" onclick="this.parentElement.remove(); updateDayPreview();" class="action-btn danger"><i class="fa-solid fa-xmark"></i></button>`;
            container.appendChild(div);
            div.querySelector('input').addEventListener('input', updateDayPreview);
        }

        function resetBuilder() {
            document.getElementById('dayBuilderForm').reset();
            document.getElementById('activitiesContainer').innerHTML = '';
            document.getElementById('imagePreviewContainer').innerHTML = '';
            document.getElementById('docPreviewContainer').innerHTML = '';
            document.getElementById('dayPreview').innerHTML = `<div class="empty-state py-10"><div class="empty-icon"><i class="fa-solid fa-eye"></i></div><p>Fill the form to see preview</p></div>`;
        }

        function updateDayPreview() {
            const date = document.getElementById('builderDate').value;
            const city = document.getElementById('builderCity').value;
            const hotelId = document.getElementById('builderHotel').value;
            const transportIds = Array.from(document.getElementById('builderTransport').selectedOptions).map(o => o.value);
            const notes = document.getElementById('builderNotes').value;
            const activities = Array.from(document.querySelectorAll('#activitiesContainer input')).map(i => i.value).filter(v => v.trim());

            const hotel = getHotels().find(h => h.id === hotelId);
            const transports = transportIds.map(id => getTransport().find(t => t.id === id)).filter(Boolean);
            const preview = document.getElementById('dayPreview');
            
            if (!date && !city) {
                preview.innerHTML = `<div class="empty-state py-10"><div class="empty-icon"><i class="fa-solid fa-eye"></i></div><p>Fill the form to see preview</p></div>`;
                return;
            }

            preview.innerHTML = `
                <div class="border-l-4 border-[var(--primary)] pl-5">
                    ${date ? `<div class="text-sm font-semibold text-[var(--primary)] mb-1">${formatFullDate(date)}</div>` : ''}
                    ${city ? `<h4 class="text-xl font-bold mb-4 flex items-center gap-2"><i class="fa-solid fa-location-dot text-[var(--secondary)]"></i>${city}</h4>` : ''}
                    ${hotel ? `<div class="p-3 bg-[var(--bg-light)] rounded-xl mb-3 flex items-center gap-3"><i class="fa-solid fa-hotel text-[var(--primary)]"></i><span class="font-semibold">${hotel.name}</span></div>` : ''}
                    ${transports.length ? `<div class="space-y-2 mb-4">${transports.map(t => `<div class="p-3 transport-${t.type} rounded-xl flex items-center gap-3"><i class="fa-solid ${getTransportIcon(t.type)}"></i><span class="font-semibold">${t.from} ‚Üí ${t.to}</span></div>`).join('')}</div>` : ''}
                    ${activities.length ? `<div class="mb-4">${activities.map(a => `<div class="activity-item"><i class="fa-solid fa-circle"></i><span>${a}</span></div>`).join('')}</div>` : ''}
                    ${notes ? `<div class="p-3 bg-amber-50 dark:bg-amber-900/20 rounded-xl text-sm"><i class="fa-solid fa-sticky-note text-amber-500 mr-2"></i>${notes}</div>` : ''}
                </div>`;
        }

        ['builderDate', 'builderCity', 'builderHotel', 'builderTransport', 'builderNotes'].forEach(id => {
            const el = document.getElementById(id);
            el.addEventListener('change', updateDayPreview);
            el.addEventListener('input', updateDayPreview);
        });

        document.getElementById('builderImages').addEventListener('change', async function(e) {
            const container = document.getElementById('imagePreviewContainer');
            container.innerHTML = '';
            for (const file of e.target.files) {
                const base64 = await fileToBase64(file);
                container.innerHTML += `<img src="${base64}" class="w-16 h-16 object-cover rounded-xl shadow-md">`;
            }
        });

        document.getElementById('builderDocs').addEventListener('change', function(e) {
            const container = document.getElementById('docPreviewContainer');
            container.innerHTML = '';
            for (const file of e.target.files) {
                container.innerHTML += `<div class="info-badge"><i class="fa-solid fa-file-pdf text-red-500 mr-2"></i>${file.name}</div>`;
            }
        });

        document.getElementById('dayBuilderForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            const activities = Array.from(document.querySelectorAll('#activitiesContainer input')).map(i => i.value).filter(v => v.trim());

            const day = {
                id: generateId(),
                date: toISODate(document.getElementById('builderDate').value),
                city: document.getElementById('builderCity').value,
                hotelId: document.getElementById('builderHotel').value || null,
                transportIds: Array.from(document.getElementById('builderTransport').selectedOptions).map(o => o.value),
                activities,
                notes: document.getElementById('builderNotes').value,
                images: [],
                documents: []
            };

            for (const file of document.getElementById('builderImages').files) {
                const base64 = await fileToBase64(file);
                const fileId = generateId();
                await saveFile(fileId, base64, 'image', file.name);
                day.images.push(fileId);
            }

            for (const file of document.getElementById('builderDocs').files) {
                const base64 = await fileToBase64(file);
                const fileId = generateId();
                await saveFile(fileId, base64, 'pdf', file.name);
                day.documents.push(fileId);
            }

            await saveDay(day);
            resetBuilder();
            switchTab('itinerary');
        });

        // PDF.js Viewer State
        let currentPdf = null;
        let currentPage = 1;
        let totalPages = 0;
        let currentScale = 1.5;
        let currentFileData = null;
        let currentFileName = null;
        let currentFileType = null;

        // File Viewer - Convert base64 to Uint8Array for PDF.js
        function base64ToUint8Array(base64Data) {
            const base64WithoutPrefix = base64Data.includes(',') ? base64Data.split(',')[1] : base64Data;
            const binaryString = atob(base64WithoutPrefix);
            const len = binaryString.length;
            const bytes = new Uint8Array(len);
            for (let i = 0; i < len; i++) {
                bytes[i] = binaryString.charCodeAt(i);
            }
            return bytes;
        }

        async function renderPdfPage(pageNum) {
            if (!currentPdf) return;
            
            try {
                const page = await currentPdf.getPage(pageNum);
                const canvas = document.getElementById('pdfCanvas');
                const ctx = canvas.getContext('2d');
                
                const viewport = page.getViewport({ scale: currentScale });
                canvas.height = viewport.height;
                canvas.width = viewport.width;
                
                await page.render({
                    canvasContext: ctx,
                    viewport: viewport
                }).promise;
                
                // Update page info
                document.getElementById('pdfPageInfo').textContent = `Page ${currentPage} of ${totalPages}`;
            } catch (error) {
                console.error('Error rendering page:', error);
            }
        }

        function pdfPrevPage() {
            if (currentPage <= 1) return;
            currentPage--;
            renderPdfPage(currentPage);
        }

        function pdfNextPage() {
            if (currentPage >= totalPages) return;
            currentPage++;
            renderPdfPage(currentPage);
        }

        function pdfZoomIn() {
            currentScale += 0.25;
            if (currentScale > 3) currentScale = 3;
            renderPdfPage(currentPage);
        }

        function pdfZoomOut() {
            currentScale -= 0.25;
            if (currentScale < 0.5) currentScale = 0.5;
            renderPdfPage(currentPage);
        }

        async function viewFile(fileId) {
            const file = await getFile(fileId);
            if (!file) { alert('File not found'); return; }
            
            // Store current file info for print/download
            currentFileData = file.data;
            currentFileName = file.name || 'document';
            currentFileType = file.type;
            
            document.getElementById('fileViewerTitle').textContent = file.name || 'File';
            
            // Update icon based on file type
            const iconEl = document.getElementById('fileViewerIcon');
            if (file.type === 'pdf') {
                iconEl.innerHTML = '<i class="fa-solid fa-file-pdf"></i>';
                iconEl.style.background = 'rgba(239, 68, 68, 0.3)';
            } else {
                iconEl.innerHTML = '<i class="fa-solid fa-image"></i>';
                iconEl.style.background = 'rgba(16, 185, 129, 0.3)';
            }
            
            // Reset visibility
            document.getElementById('pdfCanvas').classList.add('hidden');
            document.getElementById('imageViewer').classList.add('hidden');
            document.getElementById('pdfNavigation').classList.add('hidden');
            document.getElementById('pdfPageInfo').classList.add('hidden');
            document.getElementById('fileLoading').classList.add('hidden');
            document.getElementById('fileError').classList.add('hidden');
            
            if (file.type === 'pdf') {
                // Show loading
                document.getElementById('fileLoading').classList.remove('hidden');
                document.getElementById('fileViewerModal').classList.add('active');
                
                try {
                    // Convert base64 to Uint8Array for PDF.js
                    const pdfData = base64ToUint8Array(file.data);
                    
                    // Load PDF using PDF.js
                    const loadingTask = pdfjsLib.getDocument({ data: pdfData });
                    currentPdf = await loadingTask.promise;
                    totalPages = currentPdf.numPages;
                    currentPage = 1;
                    currentScale = 1.5;
                    
                    // Hide loading, show canvas and navigation
                    document.getElementById('fileLoading').classList.add('hidden');
                    document.getElementById('pdfCanvas').classList.remove('hidden');
                    document.getElementById('pdfNavigation').classList.remove('hidden');
                    document.getElementById('pdfPageInfo').classList.remove('hidden');
                    
                    // Render first page
                    await renderPdfPage(currentPage);
                    
                } catch (error) {
                    console.error('Error loading PDF:', error);
                    document.getElementById('fileLoading').classList.add('hidden');
                    document.getElementById('fileError').classList.remove('hidden');
                    document.getElementById('fileErrorMessage').textContent = 'Unable to load PDF: ' + error.message;
                }
            } else {
                // For images
                const imageViewer = document.getElementById('imageViewer');
                imageViewer.src = file.data;
                imageViewer.classList.remove('hidden');
                document.getElementById('fileViewerModal').classList.add('active');
            }
        }

        function closeFileViewer() { 
            const modal = document.getElementById('fileViewerModal');
            currentPdf = null;
            currentPage = 1;
            totalPages = 0;
            currentFileData = null;
            currentFileName = null;
            currentFileType = null;
            modal.classList.remove('active'); 
        }

        function printCurrentFile() {
            if (!currentFileData) return;
            
            const printWindow = window.open('', '_blank');
            if (!printWindow) {
                alert('Please allow pop-ups to print');
                return;
            }

            if (currentFileType === 'pdf') {
                // For PDF, create an iframe and print
                printWindow.document.write(`
                    <!DOCTYPE html>
                    <html>
                    <head><title>Print - ${currentFileName}</title></head>
                    <body style="margin:0;padding:0;">
                        <embed src="${currentFileData}" type="application/pdf" width="100%" height="100%" style="position:absolute;top:0;left:0;right:0;bottom:0;">
                    </body>
                    </html>
                `);
                printWindow.document.close();
                setTimeout(() => {
                    printWindow.print();
                }, 500);
            } else {
                // For images
                printWindow.document.write(`
                    <!DOCTYPE html>
                    <html>
                    <head>
                        <title>Print - ${currentFileName}</title>
                        <style>
                            body { margin: 0; display: flex; justify-content: center; align-items: center; min-height: 100vh; }
                            img { max-width: 100%; max-height: 100vh; }
                            @media print { body { margin: 0; } img { max-width: 100%; } }
                        </style>
                    </head>
                    <body>
                        <img src="${currentFileData}" onload="setTimeout(function(){window.print();},200);">
                    </body>
                    </html>
                `);
                printWindow.document.close();
            }
        }

        function downloadCurrentFile() {
            if (!currentFileData || !currentFileName) return;
            
            // Create download link
            const link = document.createElement('a');
            link.href = currentFileData;
            link.download = currentFileName;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        async function showGallery(dayId) {
            const day = getDays().find(d => d.id === dayId);
            if (!day?.images?.length) return;
            
            const modal = document.getElementById('galleryModal');
            const content = document.getElementById('galleryContent');
            content.innerHTML = '<div class="col-span-full text-center py-12 text-[var(--text-muted)]"><i class="fa-solid fa-spinner fa-spin text-2xl"></i></div>';
            modal.classList.add('active');
            
            let html = '';
            for (const fileId of day.images) {
                const file = await getFile(fileId);
                if (file) html += `<img src="${file.data}" class="w-full h-40 object-cover rounded-xl cursor-pointer hover:opacity-80 transition-opacity shadow-md" onclick="viewFile('${fileId}')">`;
            }
            content.innerHTML = html || '<div class="col-span-full text-center text-[var(--text-muted)]">No images found</div>';
        }

        function closeGallery() { document.getElementById('galleryModal').classList.remove('active'); }

        async function showDocuments(dayId) {
            const day = getDays().find(d => d.id === dayId);
            if (day?.documents?.length) viewFile(day.documents[0]);
        }

        // Navigation
        function switchTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(el => el.classList.add('hidden'));
            document.getElementById(`tab-${tabName}`)?.classList.remove('hidden');
            
            document.querySelectorAll('.nav-item').forEach(el => {
                el.classList.toggle('active', el.dataset.tab === tabName);
            });
            
            document.querySelectorAll('.bottom-nav-item').forEach(el => {
                el.classList.toggle('active', el.dataset.tab === tabName);
            });

            updateSelects();
            closeSidebar();
        }

        function toggleSidebar() {
            document.getElementById('sidebar').classList.toggle('open');
            document.getElementById('sidebarOverlay').classList.toggle('active');
        }

        function closeSidebar() {
            document.getElementById('sidebar').classList.remove('open');
            document.getElementById('sidebarOverlay').classList.remove('active');
        }

        function handleFabClick() {
            const currentTab = document.querySelector('.tab-content:not(.hidden)')?.id?.replace('tab-', '');
            if (currentTab === 'hotels') openHotelModal();
            else if (currentTab === 'transport-guide' || currentTab === 'transport-list') openTransportModal();
            else openDayModal();
        }

        // Utilities
        function toggleDarkMode() {
            document.documentElement.classList.toggle('dark');
            const settings = JSON.parse(localStorage.getItem(SETTINGS_KEY) || '{}');
            settings.darkMode = document.documentElement.classList.contains('dark');
            localStorage.setItem(SETTINGS_KEY, JSON.stringify(settings));
        }

        function printItinerary() { window.print(); }
        function filterItems() { renderItinerary(); }

        function exportData() {
            const data = { days: getDays(), hotels: getHotels(), transport: getTransport(), exportedAt: new Date().toISOString() };
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = `travelplan-${new Date().toISOString().split('T')[0]}.json`;
            a.click();
        }

        function openFirebaseSettings() {
            const config = getSavedFirebaseConfig();
            const isDefault = config.projectId === DEFAULT_FIREBASE_CONFIG.projectId;
            document.getElementById('configDetails').innerHTML = `
                <div class="flex items-center gap-3 text-sm">
                    <i class="fa-solid fa-database text-[var(--primary)]"></i>
                    <span class="font-semibold">${config.projectId}</span>
                </div>
                <div class="flex items-center gap-3 text-sm">
                    <i class="fa-solid fa-circle text-xs ${isOnline ? 'text-green-500' : 'text-red-500'}"></i>
                    <span>${isOnline ? 'Connected' : 'Disconnected'}</span>
                </div>
                <div class="flex items-center gap-3 text-sm">
                    <i class="fa-solid fa-tag text-[var(--text-muted)]"></i>
                    <span>${isDefault ? 'Default Config' : 'Custom Config'}</span>
                </div>`;
            document.getElementById('firebaseSettingsModal').classList.add('active');
        }

        function closeFirebaseSettings() { document.getElementById('firebaseSettingsModal').classList.remove('active'); }
        function reconfigureFirebase() { closeFirebaseSettings(); document.getElementById('firebaseConfigModal').classList.add('active'); }
        function resetToDefaultConfig() { if (confirm('Reset to default Firebase config?')) { saveFirebaseConfig(DEFAULT_FIREBASE_CONFIG); location.reload(); } }
        async function clearAllData() { if (confirm('Clear ALL data? This cannot be undone!')) { await database.ref('/').remove(); closeFirebaseSettings(); } }

        async function loadSampleData() {
            if (!confirm('Load sample data? This will add to existing data.')) return;
            showLoading('Loading sample data...');

            const hotels = [
                { id: 'h1', name: 'Hotel Le Marais', city: 'Paris', address: '23 Rue des Archives, 75004', checkIn: '2024-06-15', checkOut: '2024-06-18', reference: 'PAR-12345' },
                { id: 'h2', name: 'Hotel Helvetia', city: 'Zurich', address: 'Stauffacherquai 1, 8004', checkIn: '2024-06-18', checkOut: '2024-06-20', reference: 'ZUR-67890' }
            ];

            const transports = [
                { id: 't1', date: '2024-06-15', from: 'London St Pancras', to: 'Paris Gare du Nord', type: 'train', departureTime: '08:00', arrivalTime: '11:20', seat: 'Coach 6, Seat 42', reference: 'EUR-9876' },
                { id: 't2', date: '2024-06-18', from: 'Paris Gare de Lyon', to: 'Zurich HB', type: 'train', departureTime: '10:22', arrivalTime: '14:31', seat: 'Car 12, Seat 61', reference: 'TGV-5432' }
            ];

            const days = [
                { id: 'd1', date: '2024-06-15', city: 'Paris', hotelId: 'h1', transportIds: ['t1'], activities: ['Arrive at Gare du Nord', 'Check into hotel', 'Explore Le Marais neighborhood', 'Dinner at local bistro'], notes: 'First day in Paris!', images: [], documents: [] },
                { id: 'd2', date: '2024-06-16', city: 'Paris', hotelId: 'h1', transportIds: [], activities: ['Visit Eiffel Tower', 'Lunch at Caf√© de Flore', 'Louvre Museum', 'Evening Seine cruise'], notes: 'Big sightseeing day', images: [], documents: [] }
            ];

            for (const h of hotels) await saveHotel(h);
            for (const t of transports) await saveTransport(t);
            for (const d of days) await saveDay(d);

            hideLoading();
            closeFirebaseSettings();
        }

        // Alpine Romance Data
        async function loadAlpineRomanceData() {
            if (!confirm('Load Alpine Romance Trip?\n\nüá®üá≠üáÆüáπ Geneva ‚Üí Montreux ‚Üí Interlaken ‚Üí Lucerne ‚Üí Milan\n\nThis will clear existing data and load the full 10-day itinerary.')) return;
            
            if (!database) { alert('Database not connected. Please wait for connection.'); return; }
            
            showLoading('Loading Alpine Romance itinerary...');

            const hotels = [
                { id: 'alpine-h1', name: 'MEININGER Hotel Gen√®ve Centre Charmilles', city: 'Geneva', address: 'Near Cornavin Station', checkIn: '2026-01-01', checkOut: '2026-01-02', reference: 'GVA-2026-001', contact: 'Free Geneva Transport Card included' },
                { id: 'alpine-h2', name: 'Hotel Villa Toscane', city: 'Montreux', address: 'Opposite Train Station', checkIn: '2026-01-02', checkOut: '2026-01-03', reference: 'MTX-2026-002', contact: 'Montreux Riviera Card included' },
                { id: 'alpine-h3', name: 'Backpackers Villa Sonnenhof', city: 'Interlaken', address: 'Near Interlaken Ost', checkIn: '2026-01-03', checkOut: '2026-01-06', reference: 'INT-2026-003', contact: 'Private Double with Ensuite' },
                { id: 'alpine-h4', name: 'Hotel Luzernerhof', city: 'Lucerne', address: 'Old Town, near the lake', checkIn: '2026-01-06', checkOut: '2026-01-08', reference: 'LUZ-2026-004', contact: 'Near Chapel Bridge' },
                { id: 'alpine-h5', name: 'B&B Hotel Milano Central Station', city: 'Milan', address: 'Near Milano Centrale', checkIn: '2026-01-08', checkOut: '2026-01-10', reference: 'MIL-2026-005', contact: 'Walking distance to station' }
            ];

            const transports = [
                { id: 'alpine-t1', date: '2026-01-01', from: 'Geneva Airport', to: 'Geneva Cornavin', type: 'train', departureTime: '14:00', arrivalTime: '14:15', seat: 'No reservation needed', reference: 'FREE TICKET', notes: 'Free ticket from machine in baggage claim (left side before customs)' },
                { id: 'alpine-t2', date: '2026-01-02', from: 'Geneva', to: 'Montreux', type: 'train', departureTime: '09:30', arrivalTime: '10:30', seat: 'Sit RIGHT side for lake views', reference: 'IR90', notes: '~15 CHF pp with Half Fare Card. Buy on SBB app.' },
                { id: 'alpine-t3', date: '2026-01-03', from: 'Montreux', to: 'Interlaken Ost', type: 'train', departureTime: '09:35', arrivalTime: '12:50', seat: 'MUST BOOK at gpx.swiss', reference: 'GoldenPass Express', notes: 'üî¥ BOOK SEAT NOW! Seat ~¬£18 + ticket ~¬£16 = ~¬£34 pp. Take DIRECT train only!' },
                { id: 'alpine-t4', date: '2026-01-04', from: 'Interlaken Ost', to: 'Lauterbrunnen', type: 'train', departureTime: '09:00', arrivalTime: '09:20', seat: 'No reservation', reference: 'Regional', notes: 'Then cable car Lauterbrunnen ‚Üí Gr√ºtschalp ‚Üí train to M√ºrren' },
                { id: 'alpine-t5', date: '2026-01-05', from: 'Interlaken Ost', to: 'Grindelwald Terminal', type: 'train', departureTime: '09:00', arrivalTime: '09:35', seat: 'No reservation', reference: 'BOB Train', notes: 'For Eiger Express gondola (50% off with Swiss Pass)' },
                { id: 'alpine-t6', date: '2026-01-06', from: 'Interlaken Ost', to: 'Luzern', type: 'train', departureTime: '09:04', arrivalTime: '11:00', seat: 'Sit LEFT side for Lake Brienz views', reference: 'Luzern-Interlaken Express', notes: 'No reservation needed. ~17 CHF pp with Half Fare.' },
                { id: 'alpine-t7a', date: '2026-01-07', from: 'Luzern', to: 'Engelberg', type: 'train', departureTime: '08:10', arrivalTime: '08:53', seat: 'No reservation', reference: 'IR', notes: 'For Mount Titlis. Gondola ~¬£50 pp (50% off with Swiss Pass)' },
                { id: 'alpine-t7b', date: '2026-01-07', from: 'Engelberg', to: 'Luzern', type: 'train', departureTime: '13:00', arrivalTime: '13:43', seat: 'No reservation', reference: 'IR', notes: 'Return journey. Then free boat cruise on Lake Lucerne!' },
                { id: 'alpine-t8', date: '2026-01-08', from: 'Luzern', to: 'Milano Centrale', type: 'train', departureTime: '09:18', arrivalTime: '13:00', seat: 'Book early!', reference: 'EuroCity via Arth-Goldau', notes: 'üî¥ BOOK EARLY! ~¬£30-40 pp. Goes through Gotthard Base Tunnel.' },
                { id: 'alpine-t9a', date: '2026-01-09', from: 'Milano Centrale', to: 'Varenna-Esino', type: 'train', departureTime: '09:20', arrivalTime: '10:20', seat: 'No reservation', reference: 'RE (Regional)', notes: 'Do NOT go to Como town. Go to Varenna! ~‚Ç¨7.40 pp' },
                { id: 'alpine-t9b', date: '2026-01-09', from: 'Varenna', to: 'Bellagio', type: 'boat', departureTime: '12:00', arrivalTime: '12:15', seat: 'No reservation', reference: 'Lake Como Ferry', notes: '15 min scenic crossing to Bellagio' },
                { id: 'alpine-t9c', date: '2026-01-09', from: 'Bellagio', to: 'Varenna', type: 'boat', departureTime: '16:00', arrivalTime: '16:15', seat: 'No reservation', reference: 'Lake Como Ferry', notes: 'Return ferry to Varenna' },
                { id: 'alpine-t9d', date: '2026-01-09', from: 'Varenna-Esino', to: 'Milano Centrale', type: 'train', departureTime: '17:35', arrivalTime: '18:35', seat: 'No reservation', reference: 'RE (Regional)', notes: 'Return to Milan for Navigli Aperitivo!' },
                { id: 'alpine-t10', date: '2026-01-10', from: 'Milano Centrale', to: 'Malpensa Airport T1', type: 'train', departureTime: '12:00', arrivalTime: '12:52', seat: 'No reservation', reference: 'Malpensa Express', notes: '~‚Ç¨13 pp. Arrive 3.5 hours before flight. Check terminal!' }
            ];

            const days = [
                { id: 'alpine-d1', date: '2026-01-01', city: 'Geneva', hotelId: 'alpine-h1', transportIds: ['alpine-t1'], activities: ['13:15 Land at Geneva Airport', '14:00 Pick up FREE Geneva Transport Card from machine in baggage claim', '14:00 Train to Geneva Cornavin (15 min)', '14:30 Check-in at MEININGER Hotel', '15:30 Walk Lake Geneva Promenade', '16:00 See Jet d\'Eau (huge fountain) & Flower Clock', '17:00 Explore Old Town (Vieille Ville) - quiet & atmospheric on New Year\'s Day', 'üçΩÔ∏è Dinner: Bains des P√¢quis - Best budget Fondue in Geneva (~25 CHF pp)'], notes: '‚ö†Ô∏è Public Holiday - Shops closed, but restaurants & transport running', images: [], documents: [] },
                { id: 'alpine-d2', date: '2026-01-02', city: 'Montreux', hotelId: 'alpine-h2', transportIds: ['alpine-t2'], activities: ['09:30 Train Geneva ‚Üí Montreux (sit RIGHT for lake views)', '10:30 Arrive Montreux', '11:00 Check-in at Hotel Villa Toscane (drop bags)', '12:00 Walk flower-lined lakeside promenade', '12:30 Photo at Freddie Mercury Statue', '13:30 Bus to Chillon Castle (FREE with Montreux Riviera Card)', '14:30 Visit inside Chillon Castle (~¬£13 pp) - Switzerland\'s most beautiful historic building', 'üçΩÔ∏è Dinner: Barrel Oak (Irish pub with good food/views) or promenade caf√©'], notes: 'Direct train ~1 hour. Hotel gives Montreux Riviera Card for free transport!', images: [], documents: [] },
                { id: 'alpine-d3', date: '2026-01-03', city: 'Interlaken', hotelId: 'alpine-h3', transportIds: ['alpine-t3'], activities: ['09:35 Board GoldenPass Express (MUST have seat reservation!)', 'üöÜ Scenic journey through Swiss Alps - incredible views!', '12:50 Arrive Interlaken Ost', '13:30 Check-in at Backpackers Villa Sonnenhof', '14:00 Relax, unpack after scenic journey', '15:00 Walk around H√∂hematte park - watch paragliders land!', '16:30 Take local bus to Lake Brienz for sunset views', 'üçΩÔ∏è Dinner: H√ºsi Bierhaus - Hearty food, no cooking required'], notes: 'üî¥ MUST BOOK SEAT at gpx.swiss! Take DIRECT train (not via Zweisimmen). Seat ~¬£18 + ticket ~¬£16', images: [], documents: [] },
                { id: 'alpine-d4', date: '2026-01-04', city: 'Lauterbrunnen & M√ºrren', hotelId: 'alpine-h3', transportIds: ['alpine-t4'], activities: ['09:00 Train Interlaken Ost ‚Üí Lauterbrunnen (20 min)', '09:30 Walk the valley floor - see 72 waterfalls!', '10:00 See Staubbach Falls (297m waterfall)', '11:00 Cable car Lauterbrunnen ‚Üí Gr√ºtschalp', '11:15 Mountain train Gr√ºtschalp ‚Üí M√ºrren', '12:00 Lunch in M√ºrren - car-free village on cliff edge', 'üèîÔ∏è Views are BETTER than Interlaken!', '14:00 Walk winter hiking paths in M√ºrren', '16:00 Train/Cable car back to Interlaken', 'üçΩÔ∏è Dinner: Layaly Beirut (Lebanese) or Little Thai - Budget favorites'], notes: 'M√ºrren is magical! Car-free cliff village with stunning Alpine views.', images: [], documents: [] },
                { id: 'alpine-d5', date: '2026-01-05', city: 'Grindelwald', hotelId: 'alpine-h3', transportIds: ['alpine-t5'], activities: ['09:00 Train Interlaken Ost ‚Üí Grindelwald Terminal', '10:00 Take Eiger Express gondola to Eigergletscher (50% off with Swiss Pass)', 'üèîÔ∏è OR just explore charming Grindelwald village', '12:00 Lunch at slope-side restaurant watching skiers', '14:00 Visit First Cliff Walk (metal walkway clinging to cliff!)', 'üí° First Gondola ticket 50% off with Swiss Pass', '16:00 Return to Interlaken', 'üçΩÔ∏è Dinner in Interlaken'], notes: 'Eiger Express gondola has incredible views! First Cliff Walk is thrilling.', images: [], documents: [] },
                { id: 'alpine-d6', date: '2026-01-06', city: 'Lucerne', hotelId: 'alpine-h4', transportIds: ['alpine-t6'], activities: ['09:04 Board Luzern-Interlaken Express', 'üöÜ Sit LEFT side for Lake Brienz views!', '11:00 Arrive Lucerne', '11:30 Check-in at Hotel Luzernerhof', '13:00 Walk the famous Chapel Bridge (Kapellbr√ºcke) - world\'s oldest covered bridge', '14:30 Visit Lion Monument (dying lion carved in rock)', '16:00 Explore Musegg Wall towers - amazing city views!', 'üçΩÔ∏è Dinner: Manora Restaurant (top floor of Manor dept store)', 'üí° Budget Secret: Fresh cooked pasta/grill, amazing rooftop view, cheap for Swiss standards!'], notes: 'No reservation needed. ~17 CHF pp. Lucerne is picture-perfect!', images: [], documents: [] },
                { id: 'alpine-d7', date: '2026-01-07', city: 'Mount Titlis', hotelId: 'alpine-h4', transportIds: ['alpine-t7a', 'alpine-t7b'], activities: ['08:10 Train Lucerne ‚Üí Engelberg (43 min)', '09:00 Gondola up to Mount Titlis (3,020m)', 'üí∞ Cost: ~¬£50 pp (50% off with Swiss Travel Pass!)', '10:00 Experience the Rotating Cable Car!', '10:30 Explore Glacier Cave (inside the glacier!)', '11:00 Walk the Cliff Walk suspension bridge - thrilling!', '13:00 Return to Lucerne', '15:00 FREE boat cruise on Lake Lucerne (included with Swiss Pass)', 'üçΩÔ∏è Dinner: Rathaus Brauerei - Riverside, traditional Swiss food'], notes: 'üèîÔ∏è Mount Titlis highlights: Rotating Cable Car, Glacier Cave, Cliff Walk. Don\'t miss free boat cruise!', images: [], documents: [] },
                { id: 'alpine-d8', date: '2026-01-08', city: 'Milan', hotelId: 'alpine-h5', transportIds: ['alpine-t8'], activities: ['09:18 Train Lucerne ‚Üí Arth-Goldau (20 min)', '09:48 Change to EuroCity: Arth-Goldau ‚Üí Milano Centrale', 'üöÜ Goes through Gotthard Base Tunnel (world\'s longest rail tunnel!)', '13:00 Arrive Milan Centrale', '13:30 Check-in at B&B Hotel Milano Central Station', '15:00 Metro to Duomo', '15:30 Visit Milan Cathedral (Duomo) - stunning!', '16:30 Explore Galleria Vittorio Emanuele II (luxury shopping arcade)', '17:00 Walk to Starbucks Reserve Roastery - "Palace of Coffee", very romantic!', 'üçΩÔ∏è Dinner: Spontini near Duomo - Famous thick Milanese pizza!'], notes: 'üî¥ BOOK TRAIN EARLY! ~¬£30-40 pp. Dynamic pricing. Border crossing handled on train.', images: [], documents: [] },
                { id: 'alpine-d9', date: '2026-01-09', city: 'Lake Como', hotelId: 'alpine-h5', transportIds: ['alpine-t9a', 'alpine-t9b', 'alpine-t9c', 'alpine-t9d'], activities: ['‚ö†Ô∏è Do NOT go to Como town - go to the "Golden Triangle"!', '09:20 Train Milan ‚Üí Varenna-Esino (1 hr, ~‚Ç¨7 pp)', '10:30 Walk the "Walk of Lovers" (red-fenced path) along lake in Varenna', '11:30 Explore charming Varenna village', '12:00 Ferry Varenna ‚Üí Bellagio (15 min scenic crossing)', '12:30 Romantic lunch in Bellagio (e.g., La Fontana)', '14:30 Explore Bellagio\'s steep cobbled stairs & boutiques', '16:00 Ferry back to Varenna', '17:35 Train Varenna ‚Üí Milan', 'üçΩÔ∏è Dinner: Navigli District in Milan', 'üç∑ Have an "Aperitivo" - Buy a drink, eat from the buffet! The Italian way!'], notes: 'Lake Como day trip is magical! Navigli Aperitivo is the best deal in Milan - drinks + free buffet!', images: [], documents: [] },
                { id: 'alpine-d10', date: '2026-01-10', city: 'Departure', hotelId: null, transportIds: ['alpine-t10'], activities: ['‚òï Morning: Coffee and a croissant at local caf√©', 'üõçÔ∏è Last-minute shopping if needed', '11:00 Checkout from hotel', '12:00 Malpensa Express: Milano Centrale ‚Üí Airport (~‚Ç¨13 pp)', '12:52 Arrive Malpensa Airport Terminal 1', '‚úàÔ∏è Check-in for flight home to UK', 'üè† Fly home with amazing memories!'], notes: '‚ö†Ô∏è Arrive 3.5 hours before flight. CHECK YOUR TERMINAL (T1 or T2)! Malpensa Express goes to T1.', images: [], documents: [] }
            ];

            try {
                // Clear existing data
                await database.ref('days').remove();
                await database.ref('hotels').remove();
                await database.ref('transport').remove();

                // Insert new data
                for (const hotel of hotels) {
                    await database.ref('hotels/' + hotel.id).set(hotel);
                }
                for (const transport of transports) {
                    await database.ref('transport/' + transport.id).set(transport);
                }
                for (const day of days) {
                    await database.ref('days/' + day.id).set(day);
                }

                hideLoading();
                closeFirebaseSettings();
                alert('üéâ Alpine Romance Trip loaded successfully!\n\nüè® 5 Hotels\nüöÜ 14 Transport bookings\nüìÖ 10 Day itineraries\n\nEnjoy your trip!');
                renderAll();
            } catch (error) {
                hideLoading();
                alert('Error loading data: ' + error.message);
                console.error(error);
            }
        }

        // Auth System
        const SESSION_KEY = 'travelplan_session';
        const DEFAULT_PASSWORD = '1234';

        function initAuth() {
            const session = sessionStorage.getItem(SESSION_KEY);
            const screen = document.getElementById('authScreen');
            
            if (!session) {
                // Show auth screen
                screen.style.display = 'flex';
            } else {
                // Hide auth screen
                screen.style.display = 'none';
            }
        }

        document.getElementById('authForm').addEventListener('submit', (e) => {
            e.preventDefault();
            const password = document.getElementById('authPassword').value;
            const screen = document.getElementById('authScreen');
            
            if (password === DEFAULT_PASSWORD) {
                // Login successful
                sessionStorage.setItem(SESSION_KEY, 'true');
                
                // Hide auth screen immediately using style
                screen.style.display = 'none';
                
                // Clear password field
                document.getElementById('authPassword').value = '';
                
                // Connect to Firebase now that user is authenticated
                if (!firebaseApp) {
                    const config = getSavedFirebaseConfig();
                    initFirebase(config);
                }
            } else {
                // Wrong password
                alert('Incorrect password. Default is: 1234');
                document.getElementById('authPassword').value = '';
                document.getElementById('authPassword').focus();
                
                // Shake animation
                screen.classList.add('shake');
                setTimeout(() => screen.classList.remove('shake'), 500);
            }
        });

        function logout() {
            sessionStorage.removeItem(SESSION_KEY);
            location.reload();
        }

        // Initialize
        async function init() {
            // Check Auth First
            initAuth();

            // Load settings
            const settings = JSON.parse(localStorage.getItem(SETTINGS_KEY) || '{}');
            if (settings.darkMode) document.documentElement.classList.add('dark');

            // Auto-connect to Firebase with default config
            const config = getSavedFirebaseConfig();
            
            // Only show loading if we are logged in (or setting up)
            // But visually the auth screen covers it, so it's fine.
            
            try {
                // Don't block UI with loading if behind auth screen
                // Only connect if logged in
                if (sessionStorage.getItem(SESSION_KEY)) {
                    showLoading('Connecting to database...');
                    await initFirebase(config);
                }
            } catch (error) {
                hideLoading();
                // Only show config modal if auth passed
                if (sessionStorage.getItem(SESSION_KEY)) {
                    document.getElementById('firebaseConfigModal').classList.add('active');
                }
            }

            // Initialize builder
            addActivityInput();
            switchTab('dashboard');
            
            // Initialize date pickers
            initDateInputs();
        }

        init();
    </script>
</body>
</html>
